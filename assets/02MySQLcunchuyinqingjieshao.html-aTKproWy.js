import{_ as p,c as r,a as i,b as s,d as e,e as a,r as d,o as t}from"./app-CFOr-NH9.js";const o={},u={href:"https://dev.mysql.com/doc/refman/8.0/en/pluggable-storage-overview.html#mysql-architecture-diagram",target:"_blank",rel:"noopener noreferrer"},c={href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html",target:"_blank",rel:"noopener noreferrer"},m={href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-buffer-pool.html",target:"_blank",rel:"noopener noreferrer"},v={href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-change-buffer.html",target:"_blank",rel:"noopener noreferrer"},b={href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-adaptive-hash.html",target:"_blank",rel:"noopener noreferrer"},g={href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-redo-log-buffer.html",target:"_blank",rel:"noopener noreferrer"},h={href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html",target:"_blank",rel:"noopener noreferrer"},k={href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-tablespace.html",target:"_blank",rel:"noopener noreferrer"},f={href:"https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html",target:"_blank",rel:"noopener noreferrer"},y={href:"https://dev.mysql.com/doc/refman/8.0/en/memory-storage-engine.html",target:"_blank",rel:"noopener noreferrer"},I={href:"https://dev.mysql.com/doc/refman/8.0/en/csv-storage-engine.html",target:"_blank",rel:"noopener noreferrer"},q={href:"https://dev.mysql.com/doc/refman/8.0/en/archive-storage-engine.html",target:"_blank",rel:"noopener noreferrer"},E={href:"https://dev.mysql.com/doc/refman/8.0/en/blackhole-storage-engine.html",target:"_blank",rel:"noopener noreferrer"},A={href:"https://dev.mysql.com/doc/refman/8.0/en/merge-storage-engine.html",target:"_blank",rel:"noopener noreferrer"},S={href:"https://dev.mysql.com/doc/refman/8.0/en/federated-storage-engine.html",target:"_blank",rel:"noopener noreferrer"},M={href:"https://dev.mysql.com/doc/refman/8.0/en/example-storage-engine.html",target:"_blank",rel:"noopener noreferrer"};function T(O,n){const l=d("ExternalLinkIcon");return t(),r("div",null,[n[29]||(n[29]=i('<h2 id="一、sql语句执行过程" tabindex="-1"><a class="header-anchor" href="#一、sql语句执行过程"><span>一、SQL语句执行过程</span></a></h2><p><img src="http://blog.shengxiao.tech/images/image-20241108164142203.png" alt="image-20241108164142203"></p><p><strong>说明：</strong></p><ul><li>① SQL通过连接器提交到查询器</li></ul><blockquote><p>查询器会首先会根据查询的SQL作为key去查询缓存，如果缓存中存在对应的SQL对应的数据缓存，则直接将数据返回，否则进行第2步</p></blockquote><ul><li>② 查询器将SQL提交到解析器</li></ul><blockquote><p>1、词法分析：根据MySQL的关键字、标识符、运算符等将对应的SQL打散成一个个的token，并进行分类</p><p>2、语法分析：会对词法分析得到的数据结果根据SQL的语法规则进行校验，并最终组成一棵语法解析树</p></blockquote><ul><li>③ 解析器将处理后得到的解析树提交到预处理器</li></ul><blockquote><p>预处理器负责对解析树进行语义分析，并校验SQL语句中的表名、列名以及数据类型是否存在或正确</p></blockquote><ul><li>④ 通过预处理器校验的SQL提交到SQL优化器</li></ul><blockquote><p>生成执行计划，选择合适的索引、连接方式、排序方式等</p><p>可以通过explain 命令查看SQL的执行计划：</p><p><img src="http://blog.shengxiao.tech/images/image-20241108165037678.png" alt="image-20241108165037678"></p></blockquote>',11)),s("p",null,[n[1]||(n[1]=e("对应 ",-1)),s("a",u,[n[0]||(n[0]=e("官网MySQL架构说明",-1)),a(l)]),n[2]||(n[2]=e(" ：",-1))]),n[30]||(n[30]=i(`<p><img src="http://blog.shengxiao.tech/images/image-20241108164601064.png" alt="image-20241108164601064"></p><h2 id="二、存储引擎类型" tabindex="-1"><a class="header-anchor" href="#二、存储引擎类型"><span>二、存储引擎类型</span></a></h2><p>查看数据库存储引擎类型：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SHOW</span> ENGINES<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="http://blog.shengxiao.tech/images/image-20241108165159557.png" alt="image-20241108165159557"></p><p>可以看到在MySQL8.0版本下支持这些存储引擎</p><h3 id="_2-1、innodb" tabindex="-1"><a class="header-anchor" href="#_2-1、innodb"><span>2.1、InnoDB</span></a></h3>`,7)),s("p",null,[s("a",c,[n[3]||(n[3]=e("官网链接",-1)),a(l)])]),n[31]||(n[31]=s("blockquote",null,[s("p",null,"在MySQL8.0之后，InnoDB是MySQL的默认存储引擎。如果我们在创建表的时候不显示地指定ENGINE=xxx，则表示使用InnoDB存储引擎")],-1)),n[32]||(n[32]=s("h4",{id:"_2-1-1、innodb的架构模型",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-1-1、innodb的架构模型"},[s("span",null,"2.1.1、InnoDB的架构模型")])],-1)),n[33]||(n[33]=s("p",null,[s("img",{src:"http://blog.shengxiao.tech/images/image-20241108165325075.png",alt:"image-20241108165325075"})],-1)),n[34]||(n[34]=s("p",null,"InnoDB的内存模型：",-1)),s("ul",null,[s("li",null,[n[6]||(n[6]=s("p",null,"Buffer Pool",-1)),s("blockquote",null,[s("p",null,[s("a",m,[n[4]||(n[4]=e(" 参考链接",-1)),a(l)])]),n[5]||(n[5]=s("p",null,"buffer pool是表数据和索引缓存的主要内存区域，也是操作最频繁的区域，基本上绝大部分的操作都会先操作这块内存区然后再去同步磁盘做持久化。所以buffer pool主要是为了提升读写性能而设计的。它采用的是LRU算法+独特的链表结构：",-1))])])]),n[35]||(n[35]=s("img",{src:"http://blog.shengxiao.tech/images/image-20241108165500541.png",alt:"image-20241108165500541",style:{zoom:"50%"}},null,-1)),n[36]||(n[36]=s("blockquote",null,[s("p",null,"新插入的数据并不是直接放在队列的头或尾，而是放到5/8的中间节点上，规避了冷 数据放在队列头浪费空间和热 数据放在队尾容易直接被丢弃的弊端")],-1)),s("ul",null,[s("li",null,[n[9]||(n[9]=s("p",null,"Change Buffer",-1)),s("blockquote",null,[s("p",null,[s("a",v,[n[7]||(n[7]=e("参考链接",-1)),a(l)])]),n[8]||(n[8]=s("p",null,[e("因为二级索引的插入和修改一般都是无序的，所以change buffer在增、删、该的时候将那些在change buffer中不存在的二级索引页有变更的数据缓存缓存起来，并稍后在其他的读操作将page页加载到buffer pool时进行合并，一定程度上减少了I/O提升了性能。"),s("strong",null,"但这也意味着在读多写少的场景下并不是特别适合")],-1))])])]),n[37]||(n[37]=s("img",{src:"http://blog.shengxiao.tech/images/image-20241108165623535.png",alt:"image-20241108165623535",style:{zoom:"50%"}},null,-1)),n[38]||(n[38]=s("blockquote",null,[s("p",null,"change buffer空间大小在5.6之后的版本默认是内存空间的25%，可修改")],-1)),s("ul",null,[s("li",null,[n[12]||(n[12]=s("p",null,"Adaptive Hash Index",-1)),s("blockquote",null,[s("p",null,[s("a",b,[n[10]||(n[10]=e("参考链接",-1)),a(l)])]),n[11]||(n[11]=s("p",null,"InnoDB有一个监控索引搜索的机制，如果发现查询可以从构建一个哈希索引收益，那么就会自动构建一个哈希索引。它使用索引键的前缀来构建",-1))])]),s("li",null,[n[15]||(n[15]=s("p",null,"Log Buffer",-1)),s("blockquote",null,[s("p",null,[s("a",g,[n[13]||(n[13]=e("参考链接",-1)),a(l)])]),n[14]||(n[14]=s("p",null,"log buffer是对要写入磁盘数据的缓存，比如有大数据量的数据要写入磁盘，InnoDB可以先开辟出一块内存空间将这部分数据缓存起来，在后续异步写入磁盘，这样就提升了吞吐性能。所以适用场景就是就是有大批量数据写入或更新的场景，适当调大这个内存区域的大小可以提升I/O性能",-1))])])]),n[39]||(n[39]=i(`<h4 id="_2-1-2、innodb的优势" tabindex="-1"><a class="header-anchor" href="#_2-1-2、innodb的优势"><span>2.1.2、InnoDB的优势</span></a></h4><ul><li>支持ACID事务模型</li><li>支持行级锁，支持多用户并发读的数据一致性</li><li>主键ID有序，尽可能减少了主键检索时的io次数</li><li>支持外键，在数据添加、修改、删除的时候可以进行数据完整性校验</li></ul><h4 id="_2-1-3、innodb最佳实践" tabindex="-1"><a class="header-anchor" href="#_2-1-3、innodb最佳实践"><span>2.1.3、InnoDB最佳实践</span></a></h4><ul><li>每个表用最常用到查询的字段作为主键，或者用自增ID作为主键</li><li>保证外键走索引，并且对应的字段在各表中的数据类型是一样的</li><li>尽可能关闭自动提交，可以将一组操作用start transaction/commit来对事务操作分组</li><li>不要锁表，InnoDB支持行级锁：select ... for update</li><li>不要把所有数据都怼到系统表空间，可以开启innodb_file_per_table 来将数据放到独立表空间，或者放到通用表空间</li><li>如果有需要的话InnoDB还支持数据压缩</li></ul><h4 id="_2-1-4、查看innodb的状态" tabindex="-1"><a class="header-anchor" href="#_2-1-4、查看innodb的状态"><span>2.1.4、查看InnoDB的状态：</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SHOW</span> <span class="token keyword">ENGINE</span> <span class="token keyword">INNODB</span> <span class="token keyword">STATUS</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>默认状态：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">=====================================</span>
<span class="line"></span>
<span class="line">2024-11-05 09:37:09 135228326627072 INNODB MONITOR OUTPUT</span>
<span class="line">=====================================</span>
<span class="line"></span>
<span class="line">Per second averages calculated from the last 31 seconds</span>
<span class="line">-----------------</span>
<span class="line"></span>
<span class="line">BACKGROUND THREAD</span>
<span class="line">-----------------</span>
<span class="line"></span>
<span class="line">srv_master_thread loops: 11 srv_active, 0 srv_shutdown, 321455 srv_idle</span>
<span class="line"></span>
<span class="line">srv_master_thread log flush and writes: 0</span>
<span class="line">----------</span>
<span class="line"></span>
<span class="line">SEMAPHORES</span>
<span class="line">----------</span>
<span class="line"></span>
<span class="line">OS WAIT ARRAY INFO: reservation count 31</span>
<span class="line">OS WAIT ARRAY INFO: signal count 32</span>
<span class="line">RW-shared spins 0, rounds 0, OS waits 0</span>
<span class="line">RW-excl spins 0, rounds 0, OS waits 0</span>
<span class="line">RW-sx spins 0, rounds 0, OS waits 0</span>
<span class="line"></span>
<span class="line">Spin rounds per wait: 0.00 RW-shared, 0.00 RW-excl, 0.00 RW-sx</span>
<span class="line">------------</span>
<span class="line"></span>
<span class="line">TRANSACTIONS</span>
<span class="line">------------</span>
<span class="line"></span>
<span class="line">Trx id counter 1884</span>
<span class="line">Purge done for trx&#39;s n:o &lt; 1884 undo n:o &lt; 0 state: running but idle</span>
<span class="line">History list length 0</span>
<span class="line">LIST OF TRANSACTIONS FOR EACH SESSION:</span>
<span class="line">---TRANSACTION 416703475921704, not started</span>
<span class="line">0 lock struct(s), heap size 1128, 0 row lock(s)</span>
<span class="line">---TRANSACTION 416703475920896, not started</span>
<span class="line">0 lock struct(s), heap size 1128, 0 row lock(s)</span>
<span class="line">---TRANSACTION 416703475920088, not started</span>
<span class="line">0 lock struct(s), heap size 1128, 0 row lock(s)</span>
<span class="line">---TRANSACTION 416703475919280, not started</span>
<span class="line">0 lock struct(s), heap size 1128, 0 row lock(s)</span>
<span class="line">---TRANSACTION 416703475918472, not started</span>
<span class="line"></span>
<span class="line">0 lock struct(s), heap size 1128, 0 row lock(s)</span>
<span class="line">--------</span>
<span class="line"></span>
<span class="line">FILE I/O</span>
<span class="line">--------</span>
<span class="line"></span>
<span class="line">I/O thread 0 state: waiting for completed aio requests ((null))</span>
<span class="line">I/O thread 1 state: waiting for completed aio requests (insert buffer thread)</span>
<span class="line">I/O thread 2 state: waiting for completed aio requests (read thread)</span>
<span class="line">I/O thread 3 state: waiting for completed aio requests (read thread)</span>
<span class="line">I/O thread 4 state: waiting for completed aio requests (read thread)</span>
<span class="line">I/O thread 5 state: waiting for completed aio requests (read thread)</span>
<span class="line">I/O thread 6 state: waiting for completed aio requests (write thread)</span>
<span class="line">I/O thread 7 state: waiting for completed aio requests (write thread)</span>
<span class="line">I/O thread 8 state: waiting for completed aio requests (write thread)</span>
<span class="line">Pending normal aio reads: [0, 0, 0, 0] , aio writes: [0, 0, 0, 0] ,</span>
<span class="line"> ibuf aio reads:</span>
<span class="line">Pending flushes (fsync) log: 0; buffer pool: 0</span>
<span class="line">1120 OS file reads, 783 OS file writes, 458 OS fsyncs</span>
<span class="line"></span>
<span class="line">0.00 reads/s, 0 avg bytes/read, 0.00 writes/s, 0.00 fsyncs/s</span>
<span class="line">-------------------------------------</span>
<span class="line"></span>
<span class="line">INSERT BUFFER AND ADAPTIVE HASH INDEX</span>
<span class="line">-------------------------------------</span>
<span class="line"></span>
<span class="line">Ibuf: size 1, free list len 0, seg size 2, 0 merges</span>
<span class="line">merged operations:</span>
<span class="line"> insert 0, delete mark 0, delete 0</span>
<span class="line">discarded operations:</span>
<span class="line"> insert 0, delete mark 0, delete 0</span>
<span class="line">Hash table size 34679, node heap has 0 buffer(s)</span>
<span class="line">Hash table size 34679, node heap has 2 buffer(s)</span>
<span class="line">Hash table size 34679, node heap has 2 buffer(s)</span>
<span class="line">Hash table size 34679, node heap has 3 buffer(s)</span>
<span class="line">Hash table size 34679, node heap has 2 buffer(s)</span>
<span class="line">Hash table size 34679, node heap has 2 buffer(s)</span>
<span class="line">Hash table size 34679, node heap has 0 buffer(s)</span>
<span class="line">Hash table size 34679, node heap has 1 buffer(s)</span>
<span class="line"></span>
<span class="line">0.00 hash searches/s, 0.00 non-hash searches/s</span>
<span class="line">---</span>
<span class="line"></span>
<span class="line">LOG</span>
<span class="line">---</span>
<span class="line"></span>
<span class="line">Log sequence number          31893696</span>
<span class="line">Log buffer assigned up to    31893696</span>
<span class="line">Log buffer completed up to   31893696</span>
<span class="line">Log written up to            31893696</span>
<span class="line">Log flushed up to            31893696</span>
<span class="line">Added dirty pages up to      31893696</span>
<span class="line">Pages flushed up to          31893696</span>
<span class="line">Last checkpoint at           31893696</span>
<span class="line">Log minimum file id is       9</span>
<span class="line">Log maximum file id is       9</span>
<span class="line"></span>
<span class="line">197 log i/o&#39;s done, 0.00 log i/o&#39;s/second</span>
<span class="line">----------------------</span>
<span class="line"></span>
<span class="line">BUFFER POOL AND MEMORY</span>
<span class="line">----------------------</span>
<span class="line"></span>
<span class="line">Total large memory allocated 0</span>
<span class="line">Dictionary memory allocated 632878</span>
<span class="line">Buffer pool size   8192</span>
<span class="line">Free buffers       6913</span>
<span class="line">Database pages     1267</span>
<span class="line">Old database pages 447</span>
<span class="line">Modified db pages  0</span>
<span class="line">Pending reads      0</span>
<span class="line">Pending writes: LRU 0, flush list 0, single page 0</span>
<span class="line">Pages made young 184, not young 33</span>
<span class="line">0.00 youngs/s, 0.00 non-youngs/s</span>
<span class="line">Pages read 1096, created 173, written 445</span>
<span class="line">0.00 reads/s, 0.00 creates/s, 0.00 writes/s</span>
<span class="line">No buffer pool page gets since the last printout</span>
<span class="line">Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s</span>
<span class="line">LRU len: 1267, unzip_LRU len: 0</span>
<span class="line"></span>
<span class="line">I/O sum[0]:cur[0], unzip sum[0]:cur[0]</span>
<span class="line">--------------</span>
<span class="line"></span>
<span class="line">ROW OPERATIONS</span>
<span class="line">--------------</span>
<span class="line"></span>
<span class="line">0 queries inside InnoDB, 0 queries in queue</span>
<span class="line">0 read views open inside InnoDB</span>
<span class="line">Process ID=1, Main thread ID=135227998545664 , state=sleeping</span>
<span class="line">Number of rows inserted 48, updated 0, deleted 0, read 48</span>
<span class="line">0.00 inserts/s, 0.00 updates/s, 0.00 deletes/s, 0.00 reads/s</span>
<span class="line">Number of system rows inserted 96, updated 371, deleted 9, read 25671</span>
<span class="line"></span>
<span class="line">0.00 inserts/s, 0.00 updates/s, 0.00 deletes/s, 0.00 reads/s</span>
<span class="line">----------------------------</span>
<span class="line"></span>
<span class="line">END OF INNODB MONITOR OUTPUT</span>
<span class="line">============================</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-1-5、innodb的磁盘结构" tabindex="-1"><a class="header-anchor" href="#_2-1-5、innodb的磁盘结构"><span>2.1.5、InnoDB的磁盘结构</span></a></h4><h5 id="_2-1-5-1、表" tabindex="-1"><a class="header-anchor" href="#_2-1-5-1、表"><span>2.1.5.1、表</span></a></h5>`,10)),s("ul",null,[s("li",null,[n[19]||(n[19]=s("p",null,"行格式",-1)),s("blockquote",null,[n[18]||(n[18]=s("p",null,"REDUNDANT, COMPACT, DYNAMIC, and COMPRESSED",-1)),s("p",null,[n[17]||(n[17]=e("其中，DYNAMIC 是默认值，",-1)),s("a",h,[n[16]||(n[16]=e("参考链接",-1)),a(l)])])])])]),n[40]||(n[40]=i(`<p><img src="http://blog.shengxiao.tech/images/image-20241108165917263.png" alt="image-20241108165917263"></p><ul><li><p>主键</p><blockquote><p>强烈建议每个表都设置一个主键，如果不显示设置的话InnoDB会将隐藏字段rowid作为隐藏主键</p><p>建议用自增ID作为主键</p></blockquote></li><li><p>创建表（指定数据目录）</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t1 <span class="token punctuation">(</span>c1 <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">)</span> <span class="token keyword">DATA</span> DIRECTORY <span class="token operator">=</span> <span class="token string">&#39;/external/directory&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>通过上面语句，会将数据文件保存在对应的目录</p></blockquote></li></ul><h5 id="_2-1-5-2、索引" tabindex="-1"><a class="header-anchor" href="#_2-1-5-2、索引"><span>2.1.5.2、索引</span></a></h5><ul><li><p>索引类型</p><blockquote><p>InnoDB索引分为clustered索引和secondary索引，或者叫聚簇索引和非聚簇索引，通常情况下或者叫主键索引和二级索引。</p><p>在InnoDB中，主键索引一般就是作为clustered索引，如果没有定义主键索引，那么InnoDB会将第一个的非空的唯一索引作为clustered索引，如果连一个非空的唯一索引都没有的话，系统会自动在一个由rowid合成的列上建立一个名为GEN_CLUST_INDEX 的索引作为clustered索引。rowid是6个字节长度的随着数据插入自增的并且物理上有序的列。</p></blockquote></li><li><p>索引结构</p><blockquote><p>InnoDB的主键索引采用B+树的索引结构，它是一棵多路查找树，这种多路 的方式方式和普通二叉树相比可以有效减少层级，从而提升I/O查找效率，InnoDB的B+树结构如下图所示</p></blockquote></li></ul><p><img src="http://blog.shengxiao.tech/images/image-20241108172415736.png" alt="image-20241108172415736"></p><blockquote><p>① 所有的数据都在叶子节点上</p><p>② 叶子节点是根据id有序的排列的链表</p><p>③ 树的层级深度由数据量、page页的大小以及key的长度综合决定，总的来说key的长度越小，每个page页能放的数就越多（换句话说就是所谓的多路的“路”就越多），层级就越有可能少，I/O的次数就有可能越少，查询性能也就越优秀</p></blockquote><ul><li>全文索引 InnoDB支持对某个字段建立全文索引，比如创建表的时候指定列的全文索引：</li></ul><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> opening_lines <span class="token punctuation">(</span></span>
<span class="line">       id <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></span>
<span class="line">       opening_line <span class="token keyword">TEXT</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">       author <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">       title <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">       FULLTEXT idx <span class="token punctuation">(</span>opening_line<span class="token punctuation">)</span></span>
<span class="line">       <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询的时候使用<code>match</code>进行查询：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> opening_lines <span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>opening_line<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">&#39;Ishmael&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>但是目前MySQL支持的全文索引并不是特别好，不像ES可以指定分词器，InnoDB的全文检索对于中文会将每一个字作为一个分词，这样查询起来效率就特别低，很多时候查询结果并不是我们想要的，所以一般也很少用它。</p><h5 id="_2-1-5-3、表空间" tabindex="-1"><a class="header-anchor" href="#_2-1-5-3、表空间"><span>2.1.5.3、表空间</span></a></h5>`,12)),s("p",null,[s("a",k,[n[20]||(n[20]=e("参考链接",-1)),a(l)])]),n[41]||(n[41]=i('<ul><li><p>系统表空间</p><blockquote><p>change buffer的存储空间</p></blockquote></li><li><p>独立表空间</p><blockquote><p>为每个表开辟一个独立的空间</p></blockquote></li><li><p>通用表空间</p><blockquote><p>多个表共享一个表空间</p></blockquote></li><li><p>Undo表空间</p><blockquote><p>undo logs的存储空间</p><p>由于undo log记录的是数据的变化，而MySQL操作数据的基础单元是page页，所以在8.0.23之前的版本，undo log的大小也就和page的大小相关，在page默认16k的情况下undo表空间的大小为10M，4k、8k、32k、64k的page页大小下分别是7M、8M、20M、40M，在8.0.23之后进行了优化，默认情况下是16M，会根据后续的操作情况而定</p></blockquote></li><li><p>临时表空间</p><blockquote><p>临时表空间又有会话临时表空间和全局临时表空间：</p><p>① 会话临时表空间</p><p>一般就是存储用户自己创建的临时表和优化器在InnoDB引擎时创建的临时表</p><p>② 全局临时表空间</p><p>全局临时表空间存储用户创建的临时表的更改的回滚segement</p></blockquote></li></ul><h5 id="_2-1-5-4、doublewrite-buffer" tabindex="-1"><a class="header-anchor" href="#_2-1-5-4、doublewrite-buffer"><span>2.1.5.4、doublewrite buffer</span></a></h5><p>doublewrite buffer是为了保证数据的持久性而设计的一个缓存空间，主要就是存储数据在写入磁盘之前的更改，保证操作系统、存储系统等中间进程在正式将数据修改刷新到磁盘之前崩溃的数据恢复。</p><p><strong>既然都是写磁盘，为什么它能保证数据写入？</strong></p><p>因为doublewrite buffer是顺序写，它是一个比较大块的顺序块，通过操作系统的一次fsync 即可刷新到磁盘。</p><p>在8.0.20版本之前doublewrite buffer是在系统表空间的，而在这之后MySQL将其放到了单独的doublewrite的文件里，如最开始的InnoDB的架构图所示。</p><h5 id="_2-1-5-5、redolog" tabindex="-1"><a class="header-anchor" href="#_2-1-5-5、redolog"><span>2.1.5.5、redolog</span></a></h5><p>redolog 是一种基于磁盘的数据结构，用于在崩溃恢复期间纠正由不完整事务写入的数据，它也有自己的独立物理文件空间，写入重做日志文件的数据根据受影响的记录进行编码。</p><h5 id="_2-1-5-6、undolog" tabindex="-1"><a class="header-anchor" href="#_2-1-5-6、undolog"><span>2.1.5.6、undolog</span></a></h5><p>undolog是与单个读写事务关联的undolog记录的集合。undolog记录包含有关如何撤消事务对聚集索引记录的最新更改的信息。如果另一个事务需要将原始数据视为一致读取操作的一部分，则从undolog记录中检索未修改的数据。undolog存在于undolog segment中，undolog segment包含在rollback segment中。rollback segment位于undo表空间和全局临时表空间中。</p><h3 id="_2-2、myisam" tabindex="-1"><a class="header-anchor" href="#_2-2、myisam"><span>2.2、MyISAM</span></a></h3>',11)),s("p",null,[s("a",f,[n[21]||(n[21]=e("官网链接",-1)),a(l)])]),n[42]||(n[42]=i('<p>MyISAM存储引擎是在老牌存储引擎isam的基础之上扩展而来的。MyISAM存储引擎的表数据存储在两个文件中，一个以“.MYD”结尾（数据文件），一个以“.MYI”结尾（索引文件）。</p><p>MyISAM表的特性：</p><ul><li><p>所有数据优先低字节存储，所有数值key的value高字节存储</p></li><li><p>文件系统和操作系统支持的情况下，支持最大63位的大文件存储</p></li><li><p>MyISAM表最大支持(232)2 (1.844E+19)行数据</p></li><li><p>MyISAM表最多支持64个索引，单个索引最多支持16列</p></li><li><p>MyISAM表的索引最长支持1000个字节长度</p></li><li><p>支持每个表一个AUTO_INCREMENT列的内部处理</p><blockquote><p>MyISAM会自动更新此列以进行INSERT和UPDATE操作。这使得AUTO_INCREMENT列更快（至少10%）。序列顶部的值在删除后不会重复使用。（当AUTO_INCREMENT列被定义为多列索引的最后一列时，确实会重复使用从序列顶部删除的值。）可以使用ALTER TABLE或myisamchk重置AUTO_INCREENT值。</p></blockquote></li><li><p>BLOB和TEXT列也支持索引</p></li><li><p>索引文件和数据文件可以指定放在不同的目录</p></li><li><p>null可以用作索引列，每个key占0或者1个字节长度</p></li><li><p>每列可以设置不同的字符集</p></li></ul><p>MyISAM的行格式：</p><ul><li><p>static：默认</p><blockquote><p>固定长度，只用于没有BLOB和TEXT列的表中</p></blockquote></li><li><p>Dynamic</p><blockquote><p>动态长度，如果表里边有任意一个类型：VARCHAR、VARBINARY、BLOB或者TEXT，则会被自动设置为Dynamic格式。亦或者显示指定ROW_FORMAT=DYNAMIC</p><p>特点：</p><p>① 除了4个长度一下的字符串类型字段长度都是可变的</p><p>② null列需要一个字节的额外长度来记录其值是否为空</p><p>③ 每一行需要多少空间就占用多少空间，这比固定长度所需的磁盘空间更小</p><p>④ 崩溃的时候会比固定长度格式更难恢复一点</p></blockquote></li><li><p>Compressed</p><blockquote><p>myisampack工具生成的只读格式，可以用myisamchk工具进行解压缩</p><p>特点：</p><p>① 占用空间特别小</p><p>② 每行都是独立压缩</p><p>③ 可用于对固定长度或者动态长度的行进行压缩</p></blockquote></li></ul><p>MyISAM存储引擎的表在以下场景下可能会有问题：</p><ul><li>mysqld进程被杀</li><li>电脑非正常关机</li><li>电脑硬件出问题</li><li>用工具破坏</li><li>MySQL内部错误</li></ul><h3 id="_2-3、memory" tabindex="-1"><a class="header-anchor" href="#_2-3、memory"><span>2.3、MEMORY</span></a></h3>',8)),s("p",null,[s("a",y,[n[22]||(n[22]=e("官网链接",-1)),a(l)])]),n[43]||(n[43]=s("p",null,"MEMORY存储引擎（以前称为HEAP）创建具有存储在内存中的内容的专用表。由于数据易受崩溃、硬件问题或停电的影响，因此只能将这些表用作从其他表中提取的数据的临时工作区或只读缓存。",-1)),n[44]||(n[44]=s("h3",{id:"_2-4、csv",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-4、csv"},[s("span",null,"2.4、CSV")])],-1)),s("p",null,[s("a",I,[n[23]||(n[23]=e("官网链接",-1)),a(l)])]),n[45]||(n[45]=s("p",null,"CSV存储引擎的表的数据文件都是用指定分隔符分隔的text文件，非常方便直接阅读。但是也会有如下限制：",-1)),n[46]||(n[46]=s("ul",null,[s("li",null,"所有表不支持索引"),s("li",null,"所有表不支持分区"),s("li",null,"所有的列不能为空")],-1)),n[47]||(n[47]=s("h3",{id:"_2-5、archive",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-5、archive"},[s("span",null,"2.5、ARCHIVE")])],-1)),s("p",null,[s("a",q,[n[24]||(n[24]=e("官网链接",-1)),a(l)])]),n[48]||(n[48]=s("p",null,"ARCHIVE存储引擎生成专用表，以非常小的占用空间存储大量未索引的数据",-1)),n[49]||(n[49]=s("h3",{id:"_2-6、blackhole",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-6、blackhole"},[s("span",null,"2.6、BLACKHOLE")])],-1)),s("p",null,[s("a",E,[n[25]||(n[25]=e("官网链接",-1)),a(l)])]),n[50]||(n[50]=s("p",null,"顾名思义的一个存储引擎，这个引擎的表就像一个黑洞，把数据放进去就没了，不会保存，每次查到的都是空，感觉没啥用，想不出什么场景会用到它",-1)),n[51]||(n[51]=s("h3",{id:"_2-7、merge",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-7、merge"},[s("span",null,"2.7、MERGE")])],-1)),s("p",null,[s("a",A,[n[26]||(n[26]=e("官网链接",-1)),a(l)])]),n[52]||(n[52]=s("p",null,"MERGE存储引擎，也称为MRG_MyISAM引擎，是可以作为一个整体使用的相同MyISAM表的集合。",-1)),n[53]||(n[53]=s("p",null,"基本不用，pass",-1)),n[54]||(n[54]=s("h3",{id:"_2-8、federated",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-8、federated"},[s("span",null,"2.8、FEDERATED")])],-1)),s("p",null,[s("a",S,[n[27]||(n[27]=e("官网链接",-1)),a(l)])]),n[55]||(n[55]=s("p",null,"FEDERATED存储引擎允许您从远程MySQL数据库访问数据，而无需使用复制或集群技术。查询本地FEDERATED表会自动从远程（联邦）表中提取数据。本地表上没有存储任何数据。",-1)),n[56]||(n[56]=s("p",null,"默认不启用，如果要启用的话在确保你使用的安装包支持这个存储引擎的条件下用，在程序启动时用“--federated”参数来启用",-1)),n[57]||(n[57]=s("h3",{id:"_2-9、example",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-9、example"},[s("span",null,"2.9、EXAMPLE")])],-1)),s("p",null,[s("a",M,[n[28]||(n[28]=e("官网链接",-1)),a(l)])]),n[58]||(n[58]=s("p",null,"示例存储引擎是一个什么都不做的存根引擎。它的目的是作为MySQL源代码中的一个例子，说明如何开始编写新的存储引擎",-1)),n[59]||(n[59]=s("hr",null,null,-1)),n[60]||(n[60]=s("p",null,[s("img",{src:"http://blog.shengxiao.tech/images/subscribe1.png",alt:"公众号引导关注-《扫码关注，一起学习吧》"})],-1))])}const N=p(o,[["render",T]]),w=JSON.parse('{"path":"/series/db/mysql/02MySQLcunchuyinqingjieshao.html","title":"2、MySQL存储引擎介绍","lang":"en-US","frontmatter":{"title":"2、MySQL存储引擎介绍","date":"2024-11-10T00:00:00.000Z","categories":["mysql","数据库"],"tags":["mysql","数据库"]},"headers":[{"level":2,"title":"一、SQL语句执行过程","slug":"一、sql语句执行过程","link":"#一、sql语句执行过程","children":[]},{"level":2,"title":"二、存储引擎类型","slug":"二、存储引擎类型","link":"#二、存储引擎类型","children":[{"level":3,"title":"2.1、InnoDB","slug":"_2-1、innodb","link":"#_2-1、innodb","children":[]},{"level":3,"title":"2.2、MyISAM","slug":"_2-2、myisam","link":"#_2-2、myisam","children":[]},{"level":3,"title":"2.3、MEMORY","slug":"_2-3、memory","link":"#_2-3、memory","children":[]},{"level":3,"title":"2.4、CSV","slug":"_2-4、csv","link":"#_2-4、csv","children":[]},{"level":3,"title":"2.5、ARCHIVE","slug":"_2-5、archive","link":"#_2-5、archive","children":[]},{"level":3,"title":"2.6、BLACKHOLE","slug":"_2-6、blackhole","link":"#_2-6、blackhole","children":[]},{"level":3,"title":"2.7、MERGE","slug":"_2-7、merge","link":"#_2-7、merge","children":[]},{"level":3,"title":"2.8、FEDERATED","slug":"_2-8、federated","link":"#_2-8、federated","children":[]},{"level":3,"title":"2.9、EXAMPLE","slug":"_2-9、example","link":"#_2-9、example","children":[]}]}],"git":{"createdTime":1765551376000,"updatedTime":1765551376000,"contributors":[{"name":"qknavy","email":"qknavy@aliyun.com","commits":1}]},"filePathRelative":"series/db/mysql/02MySQL存储引擎介绍.md"}');export{N as comp,w as data};
