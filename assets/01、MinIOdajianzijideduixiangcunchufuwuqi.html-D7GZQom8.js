import{_ as l,c,b as p,a as s,d as t,e,r as i,o}from"./app-CRA4yNID.js";const u={},k={href:"https://minio.org.cn/docs/minio/linux/operations/installation.html",target:"_blank",rel:"noopener noreferrer"},r={href:"https://minio.org.cn/docs/minio/linux/developers/minio-drivers.html?ref=docs#java-sdk",target:"_blank",rel:"noopener noreferrer"},d={href:"https://min.io/docs/minio/linux/developers/java/API.html",target:"_blank",rel:"noopener noreferrer"};function m(v,n){const a=i("ExternalLinkIcon");return o(),c("div",null,[n[3]||(n[3]=p('<ul><li></li></ul><div class="custom-container info"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8h.01"></path><path d="M11 12h1v4h1"></path></g></svg><p class="custom-container-title">INFO</p><p>最近项目上有需要用到文件存储的功能，综合考量之后决定采用MinIO来存储，于是这篇文章就简单记录一下MinIO服务端的搭建和客户端的基本使用</p></div><p>官方安装包：https://dl.minio.org.cn/server/minio/release/[操作系统平台]/minio，以mac为例</p><p><img src="http://blog.shengxiao.tech/images/image-20241213151251098.png" alt="image-20241213151251098"></p><h2 id="_1、minio服务端搭建【单节点单磁盘部署】" tabindex="-1"><a class="header-anchor" href="#_1、minio服务端搭建【单节点单磁盘部署】"><span>1、MinIO服务端搭建【单节点单磁盘部署】</span></a></h2>',5)),s("p",null,[s("a",k,[n[0]||(n[0]=t("【参考文档】",-1)),e(a)])]),n[4]||(n[4]=p(`<p>由于这里记录的是在开发环境的搭建，所以这里不考虑高可用高性能这类需求，只要求满足功能性要求即可，所以这里采用docker的方式部署单节点单磁盘，集群模式参考官方文档说明，也很简单</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\\</span></span>
<span class="line">   <span class="token parameter variable">-p</span> <span class="token number">9000</span>:9000 <span class="token punctuation">\\</span></span>
<span class="line">   <span class="token parameter variable">-p</span> <span class="token number">9001</span>:9001 <span class="token punctuation">\\</span></span>
<span class="line">   <span class="token parameter variable">--name</span> minio <span class="token punctuation">\\</span></span>
<span class="line">   <span class="token parameter variable">-e</span> <span class="token string">&quot;MINIO_ROOT_USER=changeme&quot;</span> <span class="token punctuation">\\</span></span>
<span class="line">   <span class="token parameter variable">-e</span> <span class="token string">&quot;MINIO_ROOT_PASSWORD=changeme&quot;</span> <span class="token punctuation">\\</span></span>
<span class="line">   <span class="token parameter variable">-v</span> /opt/minio/data:/data <span class="token punctuation">\\</span></span>
<span class="line">   minio:latest server /data --console-address <span class="token string">&quot;:9001&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>端口9000主要提供给各个客户端使用，而9001主要是给web控制台使用</p><p>数据目录挂载在了本地<code>/opt/minio/data</code>目录下</p><p>设置了账号<code>MINIO_ROOT_USER</code>和密码<code>MINIO_ROOT_PASSWORD</code>，对应的值自行修改</p><p>这里拉不下来官方镜像的话可以拉我的阿里云镜像：registry.cn-hangzhou.aliyuncs.com/xhsx/minio:latest</p></blockquote><p><strong>如果用docker-compose的方式运行的话</strong>，可以做简单调整：</p><ul><li>添加一个config文件</li></ul><div class="language-config line-numbers-mode" data-highlighter="prismjs" data-ext="config" data-title="config"><pre><code><span class="line"># MINIO_ROOT_USER and MINIO_ROOT_PASSWORD sets the root account for the MinIO server.</span>
<span class="line"># This user has unrestricted permissions to perform S3 and administrative API operations on any resource in the deployment.</span>
<span class="line"># Omit to use the default values &#39;minioadmin:minioadmin&#39;.</span>
<span class="line"># MinIO recommends setting non-default values as a best practice, regardless of environment</span>
<span class="line"></span>
<span class="line">MINIO_ROOT_USER=changeme</span>
<span class="line">MINIO_ROOT_PASSWORD=changeme</span>
<span class="line"></span>
<span class="line"># MINIO_VOLUMES sets the storage volume or path to use for the MinIO server.</span>
<span class="line"></span>
<span class="line">MINIO_VOLUMES=&quot;/mnt/data&quot;</span>
<span class="line"></span>
<span class="line"># MINIO_OPTS sets any additional commandline options to pass to the MinIO server.</span>
<span class="line"># 例如， \`--console-address :9001\` sets the MinIO Console listen port</span>
<span class="line">MINIO_OPTS=&quot;--console-address :9001&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>docker-compose.yaml</code>文件如下：</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">minio</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> minio</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/xhsx/minio<span class="token punctuation">:</span>latest</span>
<span class="line">    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;9000:9000&quot;</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;9001:9001&quot;</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./data<span class="token punctuation">:</span>/mnt/data</span>
<span class="line">      <span class="token punctuation">-</span> ./config<span class="token punctuation">:</span>/etc/config.env</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> MINIO_CONFIG_ENV_FILE=/etc/config.env</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> server <span class="token punctuation">-</span><span class="token punctuation">-</span>console<span class="token punctuation">-</span>address &quot;<span class="token punctuation">:</span>9001&quot;</span>
<span class="line">    <span class="token key atrule">deploy</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">resources</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">limits</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">memory</span><span class="token punctuation">:</span> 1024M</span>
<span class="line">          <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token string">&#39;1&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行<code>docker-compose up -d</code>启动程序</p><p>容器启动成功之后就可以通过浏览器<code>http://IP+9000</code>或者<code>http://IP+9001</code>访问，账号和密码就是上面自己设置的值</p><p><img src="http://blog.shengxiao.tech/images/image-20241211162312984.png" alt="image-20241211162312984"></p><p>可以自己在页面控制台手动创建bucket或者上传文件到指定的bucket，或者在console控制台通过命令行操作也行</p><p><img src="http://blog.shengxiao.tech/images/image-20241211162354130.png" alt="image-20241211162354130"></p><h2 id="_2、java客户端的使用" tabindex="-1"><a class="header-anchor" href="#_2、java客户端的使用"><span>2、Java客户端的使用</span></a></h2><p>服务端搭建完成之后，如何通过Java去操作文档呢？</p>`,15)),s("p",null,[s("a",r,[n[1]||(n[1]=t("【参考文档】",-1)),e(a)])]),s("p",null,[s("a",d,[n[2]||(n[2]=t("【使用手册】",-1)),e(a)])]),n[5]||(n[5]=p(`<p>官方提供了一个Java快速开发指南：https://minio.org.cn/docs/minio/linux/developers/java/minio-java.html#minio-java-quickstart</p><h3 id="_2-1、文件上传" tabindex="-1"><a class="header-anchor" href="#_2-1、文件上传"><span>2.1、文件上传</span></a></h3><p>文档里这里详细描述了怎么用Java客户端去操作MinIO，并提供了一个demo</p><p>Maven依赖：</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.minio<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>minio<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.5.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.squareup.okhttp3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>okhttp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>java代码</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">BucketExistsArgs</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">MakeBucketArgs</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">MinioClient</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span></span><span class="token class-name">UploadObjectArgs</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>minio<span class="token punctuation">.</span>errors<span class="token punctuation">.</span></span><span class="token class-name">MinioException</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StopWatch</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Objects</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUploader</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">MinioClient</span> minioClient <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">StopWatch</span> stopWatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StopWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// Create a minioClient with the MinIO server playground, its access key and secret key.</span></span>
<span class="line">            minioClient <span class="token operator">=</span></span>
<span class="line">                    <span class="token class-name">MinioClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                            <span class="token punctuation">.</span><span class="token function">endpoint</span><span class="token punctuation">(</span><span class="token string">&quot;http://10.0.2.197:9000/&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                            <span class="token punctuation">.</span><span class="token function">credentials</span><span class="token punctuation">(</span><span class="token string">&quot;fZKRjP2RDTm23kf5MsBa&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NuRQjfadNlwamCtGqBas2nG90JMUVuFjoW1pzMFF&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// Make &#39;asiatrip&#39; bucket if not exist.</span></span>
<span class="line">            <span class="token keyword">boolean</span> found <span class="token operator">=</span> minioClient<span class="token punctuation">.</span><span class="token function">bucketExists</span><span class="token punctuation">(</span><span class="token class-name">BucketExistsArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;liuyuankun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>found<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// Make a new bucket called &#39;asiatrip&#39;.</span></span>
<span class="line">                minioClient<span class="token punctuation">.</span><span class="token function">makeBucket</span><span class="token punctuation">(</span><span class="token class-name">MakeBucketArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;liuyuankun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Bucket &#39;liuyuankun&#39; already exists.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// Upload &#39;/home/user/Photos/asiaphotos.zip&#39; as object name &#39;asiaphotos-2015.zip&#39; to bucket</span></span>
<span class="line">            <span class="token comment">// &#39;asiatrip&#39;.</span></span>
<span class="line">            stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">&quot;开始上传&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            minioClient<span class="token punctuation">.</span><span class="token function">uploadObject</span><span class="token punctuation">(</span></span>
<span class="line">                    <span class="token class-name">UploadObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                            <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;liuyuankun&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                            <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">&quot;instantclient-basic-linux.x64-12.1.0.2.0.zip&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                            <span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/navy/Downloads/instantclient-basic-linux.x64-12.1.0.2.0.zip&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;/Users/navy/Downloads/instantclient-basic-linux.x64-12.1.0.2.0.zip&#39; is successfully uploaded as &quot;</span></span>
<span class="line">                            <span class="token operator">+</span> <span class="token string">&quot;object &#39;instantclient-basic-linux.x64-12.1.0.2.0.zip&#39; to bucket &#39;liuyuankun&#39;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MinioException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Error occurred: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP trace: &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">httpTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>minioClient<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">              minioClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stopWatch<span class="token punctuation">.</span><span class="token function">prettyPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意：</p><p>①、这里连接MinIO服务端的端口是9000</p><p>②、客户端连接还需要一个credentials值，AccessKey和SecretKey需要在服务端先创建，具体位置在下图所示的地方：</p></blockquote><p><img src="http://blog.shengxiao.tech/images/image-20241211163130500.png" alt="image-20241211163130500"></p><blockquote><p>根据提示描述，这里的SecretKey只在创建成功的时候显示一次，防止忘记，可以将文件Download下来保存</p></blockquote><p>运行上面的示例代码，就可以将文件上传到MinIO服务端了</p><p><img src="http://blog.shengxiao.tech/images/image-20241211163439494.png" alt="image-20241211163439494"></p><h3 id="_2-2、文件预览" tabindex="-1"><a class="header-anchor" href="#_2-2、文件预览"><span>2.2、文件预览</span></a></h3><p>要实现文件预览，需要首先调用<code>getPresignedObjectUrl</code> api获取一个预览地址</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testGetPreviewUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token class-name">MinioClient</span> minioClient <span class="token operator">=</span> <span class="token function">getMinioClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">GetPresignedObjectUrlArgs</span> args <span class="token operator">=</span> <span class="token class-name">GetPresignedObjectUrlArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;liuyuankun&quot;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">&quot;1.png&quot;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> presignedObjectUrl <span class="token operator">=</span> minioClient<span class="token punctuation">.</span><span class="token function">getPresignedObjectUrl</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>presignedObjectUrl<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">    minioClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成的地址：http://10.0.2.197:9000/liuyuankun/1.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=fZKRjP2RDTm23kf5MsBa%2F20241213%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20241213T021117Z&amp;X-Amz-Expires=604800&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=6d93966a59cd2c67b492832f914ea578d337c4a13fe3868fb4a95b1571a44a40</p><p>这个地址也太长了吧，而且默认的只有7天的有效期</p><p><img src="http://blog.shengxiao.tech/images/image-20241213102413334.png" alt="image-20241213102413334"></p><p>这时候如果我们要长期访问，并且对文件没有特殊的安全性要求，则可以将bucket设置为Public，然后整个bucket下的文件就都可以通过域名+bucket+文件名方式访问了。</p><p><img src="http://blog.shengxiao.tech/images/image-20241213102957578.png" alt="image-20241213102957578"></p><p>比如我的服务器地址是<code>10.0.2.197</code>，bucket名称为<code>liuyuankun</code>，文件名为<code>1.png</code>，则可以通过下面地址访问：</p><p>http://10.0.2.197:9000/liuyuankun/1.png</p><blockquote><p>注意这里用的是9000端口，如果用9001端口的话默认会直接进入web控制台而不是直接预览文件</p></blockquote><p>当然如果不想要全部放开bucket里的内容，也可以设置bucket的访问策略达到同样的目的，可以通过文件前缀配合访问权限设置</p><p><img src="http://blog.shengxiao.tech/images/image-20241213103707585.png" alt="image-20241213103707585"></p><p><img src="http://blog.shengxiao.tech/images/image-20241213103952102.png" alt="image-20241213103952102"></p><h3 id="_2-3、文件下载" tabindex="-1"><a class="header-anchor" href="#_2-3、文件下载"><span>2.3、文件下载</span></a></h3><p>文件下载也非常简单，直接调用<code>downloadObject</code> api即可</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">DownloadObjectArgs</span> a <span class="token operator">=</span> <span class="token class-name">DownloadObjectArgs</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">bucket</span><span class="token punctuation">(</span><span class="token string">&quot;liuyuankun&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token string">&quot;1.png&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">filename</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/navy/Downloads/abba.png&quot;</span><span class="token punctuation">)</span>	<span class="token comment">//保存文件到哪儿</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">minioClient<span class="token punctuation">.</span><span class="token function">downloadObject</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,29))])}const g=l(u,[["render",m]]),h=JSON.parse('{"path":"/series/container/docker/01、MinIOdajianzijideduixiangcunchufuwuqi.html","title":"01、MinIO搭建自己的对象存储服务器","lang":"en-US","frontmatter":{"title":"01、MinIO搭建自己的对象存储服务器","date":"2024-12-15T00:00:00.000Z","categories":["docker","中间件"],"tags":["docker","MinIO"]},"headers":[{"level":2,"title":"1、MinIO服务端搭建【单节点单磁盘部署】","slug":"_1、minio服务端搭建【单节点单磁盘部署】","link":"#_1、minio服务端搭建【单节点单磁盘部署】","children":[]},{"level":2,"title":"2、Java客户端的使用","slug":"_2、java客户端的使用","link":"#_2、java客户端的使用","children":[{"level":3,"title":"2.1、文件上传","slug":"_2-1、文件上传","link":"#_2-1、文件上传","children":[]},{"level":3,"title":"2.2、文件预览","slug":"_2-2、文件预览","link":"#_2-2、文件预览","children":[]},{"level":3,"title":"2.3、文件下载","slug":"_2-3、文件下载","link":"#_2-3、文件下载","children":[]}]}],"git":{"createdTime":null,"updatedTime":null,"contributors":[]},"filePathRelative":"series/container/docker/01、MinIO搭建自己的对象存储服务器.md"}');export{g as comp,h as data};
