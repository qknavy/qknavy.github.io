(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{542:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[s._v("本文简单介绍es集群的基本搭建（带密码）")])]),s._v(" "),t("h2",{attrs:{id:"_1、下载解压"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、下载解压"}},[s._v("#")]),s._v(" 1、下载解压")]),s._v(" "),t("p",[s._v("链接: https://pan.baidu.com/s/1L96CZ4OBSgOsNT7Q39oRiA  密码: sjhf")]),s._v(" "),t("h2",{attrs:{id:"_2、修改配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、修改配置文件"}},[s._v("#")]),s._v(" 2、修改配置文件")]),s._v(" "),t("p",[t("code",[s._v("elasticsearch.yml")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1、集群名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster.name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" qknavy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("es\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2、节点名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node.name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" worker01\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3、数据存储路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path.data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /home/qknavy/ES/es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("7.9.0/es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4、日志存储路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path.logs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /home/qknavy/ES/es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("7.9.0/es"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("logs\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#5、绑定IP")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network.host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 172.24.201.182\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#6、集群节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery.seed_hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.24.201.101:9300"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.24.201.102:9300"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.24.201.103:9300"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#7、初始化master节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster.initial_master_nodes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.24.201.101:9300"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#8、数据通信加密")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.verification_mode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" certificate\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.keystore.path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" qknavy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ca"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("7.9.0.p12\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("xpack.security.transport.ssl.truststore.path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" qknavy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ca"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("7.9.0.p12\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("blockquote",[t("p",[s._v("注意生成证书的步骤：\n1、准备节点信息的yml文件")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instances")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qknavy-ca-7.9.0"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ip")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.24.201.101"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.24.201.102"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.24.201.103"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("2、生成证书")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/elasticsearch-certutil cert --silent -in ./bin/ca-7.9.0.yaml --out ./config/ca.zip\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这里的目录都是相对es的home目录")]),s._v(" "),t("p",[s._v("3、解压将证书文件放到"),t("code",[s._v("config")]),s._v("目录下")])]),s._v(" "),t("h2",{attrs:{id:"_3、启动es-必须非root账户运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、启动es-必须非root账户运行"}},[s._v("#")]),s._v(" 3、启动ES(必须非root账户运行)")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/elasticsearch -d\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("此时发现用head插件访问或者通过URL访问的时候弹出了一个账号密码框")]),s._v(" "),t("h2",{attrs:{id:"_4、配置密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、配置密码"}},[s._v("#")]),s._v(" 4、配置密码")]),s._v(" "),t("p",[s._v("启用了xpack之后，需要为我们的集群设置对应的密码（内置了一系列账号，比如elastic、kibana等）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/elasticsearch-setup-passwords interactive\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("blockquote",[t("p",[s._v("执行上面命令的时候可以根据提示为对应的账号设置密码，最终密码信息会存储在索引"),t("code",[s._v(".security-7")]),s._v("下")])]),s._v(" "),t("h2",{attrs:{id:"_5、运行kibana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、运行kibana"}},[s._v("#")]),s._v(" 5、运行"),t("code",[s._v("kibana")])]),s._v(" "),t("p",[s._v("修改kibana的配置文件")]),s._v(" "),t("blockquote",[t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1、绑定主机")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server.host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.24.201.101"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2、配置ES集群节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch.hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://172.24.201.101:9200"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://172.24.201.102:9200"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://172.24.201.103:9200"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3、账号和密码(elastic默认为最高权限账号)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch.username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elastic"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch.password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxxxx"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])]),s._v(" "),t("p",[s._v("修改完成之后启动")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kibana "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("访问对应的地址即可："),t("code",[s._v("http://172.24.201.101:5601")])]),s._v(" "),t("p",[s._v("但是上述配置方式存在一定的安全隐患，特别是连接es的用户名密码都是明文，基于安全的考虑，kibana提供了"),t("code",[s._v("keystore")]),s._v("的机制，通过kibana提供的工具"),t("code",[s._v("kibana-keystore")]),s._v("配置，具体步骤如下：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("创建keystore")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kibana-keystore create\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("执行完成之后在config目录下会生成一个"),t("code",[s._v("kibana-keystore")]),s._v("文件，这个文件是加密形式的")])]),s._v(" "),t("li",[t("p",[s._v("添加对应的配置")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("./bin/kibana-keystore "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" elasticsearch.username\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输入连接es的用户名")]),s._v("\n./bin/kibana-keystore "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" elasticsearch.password\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据连接es的密码")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("blockquote",[t("p",[s._v("其他配置同样也可以采用这种方式配置")])])])]),s._v(" "),t("p",[s._v("重启kibana")])])}),[],!1,null,null,null);a.default=e.exports}}]);