(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{572:function(s,a,t){"use strict";t.r(a);var n=t(4),r=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[s._v("ES是文档型数据库，不是关系型数据库，不具备严格的ACID事务特性，所以，不要企图在严格事务性场景中运用它")])]),s._v(" "),t("h2",{attrs:{id:"_1、索引创建方式与规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、索引创建方式与规范"}},[s._v("#")]),s._v(" 1、索引创建方式与规范")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("索引概念：")])]),s._v(" "),t("li",[t("p",[s._v("索引别名")]),s._v(" "),t("p",[s._v("创建索引的时候默认会创建一个和索引同名的别名。别名对于数据迁移非常有用，只需要将别名指定到另外一个索引即可，不像关系型数据库需要建表、迁移数据、删表等步骤")])]),s._v(" "),t("li",[t("p",[s._v("索引命名")])])]),s._v(" "),t("blockquote",[t("p",[s._v("为了管理的便利性，需要一定的命名规范：")])]),s._v(" "),t("ul",[t("li",[s._v("业务类型：索引名+数字版本")])]),s._v(" "),t("blockquote",[t("blockquote",[t("p",[s._v("如：商品索引"),t("code",[s._v("product_001")]),s._v("，店铺索引"),t("code",[s._v("store_001")])])]),s._v(" "),t("ul",[t("li",[s._v("日志类型：索引名+日期时间")])]),s._v(" "),t("blockquote",[t("p",[s._v("如系统日志"),t("code",[s._v("system-log-2020.08.21.001")]),s._v("，业务日志"),t("code",[s._v("product-log-2020.08.21.001")])])])]),s._v(" "),t("ul",[t("li",[s._v("应用意义")])]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("数据隔离")]),s._v("、\n"),t("code",[s._v("查询便利")]),s._v("、\n"),t("code",[s._v("模糊匹配")]),s._v("、\n"),t("code",[s._v("精确指定索引")])])]),s._v(" "),t("h3",{attrs:{id:"_1-1、创建索引的方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1、创建索引的方式"}},[s._v("#")]),s._v(" 1.1、创建索引的方式")]),s._v(" "),t("h4",{attrs:{id:"动态创建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#动态创建"}},[s._v("#")]),s._v(" * 动态创建")]),s._v(" "),t("p",[s._v("无需提前创建，第一条数据插入即可创建完成")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("POST qknavy_001/_doc\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"navy"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"birthday"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2020-08-08"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("查看："),t("code",[s._v("GET qknavy_001/_search")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"took"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"timed_out"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_shards"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"successful"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"skipped"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"failed"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"hits"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"total"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"value"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"relation"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"eq"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"max_score"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"hits"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_index"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qknavy_001"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_type"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_doc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_id"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"u9VwIHQBnFGR0rR_6tDJ"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_score"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"_source"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"navy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"birthday"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2020-08-08"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("p",[t("strong",[s._v("应用场景：")])]),s._v(" "),t("p",[s._v("非严格数据模型限制规范的场景、日志、监控")]),s._v(" "),t("h4",{attrs:{id:"静态创建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#静态创建"}},[s._v("#")]),s._v(" * 静态创建")]),s._v(" "),t("p",[t("strong",[s._v("概念")]),s._v("：依据客观背景提前创建好索引，提前做好索引数据分布与相应设置")]),s._v(" "),t("p",[t("strong",[s._v("应用场景")]),s._v("：")]),s._v(" "),t("blockquote",[t("p",[s._v("A：业务系统数据需要严格规范")]),s._v(" "),t("p",[s._v("B：索引分布在极端情况下需要消耗集群资源，避免几种创建索引时集群响应慢的问题")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("PUT qknavy_002\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"settings"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number_of_replicas"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number_of_shards"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h4",{attrs:{id:"滚动创建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#滚动创建"}},[s._v("#")]),s._v(" * 滚动创建")]),s._v(" "),t("p",[t("strong",[s._v("概念")]),s._v("：")]),s._v(" "),t("blockquote",[t("p",[s._v("利用别名alias")]),s._v(" "),t("p",[s._v("利用rollover特性")]),s._v(" "),t("p",[s._v("自动化滚动创建，达到一定阈值创建")])]),s._v(" "),t("p",[t("strong",[s._v("应用场景")]),s._v("：")]),s._v(" "),t("blockquote",[t("p",[s._v("日志领域，需要自动化依据触发条件滚动创建")]),s._v(" "),t("p",[s._v("大数据领域，单索引能力局限需要创建很多")])]),s._v(" "),t("p",[t("strong",[s._v("步骤")]),s._v("：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("先创建一个别名的索")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("PUT qknavy_0001_rollover-000001\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"aliases"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qknavy_0001_rollover"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("然后绑定别名")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("POST qknavy_0001_rollover/_rollover\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"conditions"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"max_docs"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"max_age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1d"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"max_size"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1gb"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("插入数据")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("POST qknavy_0001_rollover\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"navy"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])]),s._v(" "),t("p",[s._v("当插入的数据达到上面设置的阈值的时候就会自动生成新的索引。默认索引后缀为六位数字，从"),t("code",[s._v("000001")]),s._v("开始，每次加1。")]),s._v(" "),t("p",[t("strong",[s._v("但是插入数据的时候注意使用的是别名，而不是某一个索引")])]),s._v(" "),t("h3",{attrs:{id:"_1-2、索引必备的设置与默认配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2、索引必备的设置与默认配置"}},[s._v("#")]),s._v(" 1.2、索引必备的设置与默认配置")]),s._v(" "),t("h4",{attrs:{id:"静态设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#静态设置"}},[s._v("#")]),s._v(" * 静态设置")]),s._v(" "),t("p",[s._v("索引分片：默认为1，创建索引时需要指定，之后索引活动期间不可变，后期只能重建")]),s._v(" "),t("blockquote",[t("p",[s._v("副本和刷新时间可以调整")])]),s._v(" "),t("p",[s._v("索引字段类型：字段类型不可变，一旦指定几乎不可变。若要修改，则需要刷新所有历史数据，等同于索引重建")]),s._v(" "),t("h2",{attrs:{id:"_2、索引文档的数据模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、索引文档的数据模型"}},[s._v("#")]),s._v(" 2、索引文档的数据模型")]),s._v(" "),t("blockquote",[t("p",[s._v("数据模型类别（对比传统关系型数据库）：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("数据库=ES集群（一个关系型数据库等同于一个ES集群）")])]),s._v(" "),t("li",[t("p",[s._v("数据表=ES索引（一个数据表等同一个ES索引。新版本不支持一个索引多个type。）")])]),s._v(" "),t("li",[t("p",[s._v("行记录=ES文档（一条数据等同一条ES文档）")])])])]),s._v(" "),t("p",[s._v("索引的字段名不要有点"),t("code",[s._v(".")]),s._v("，可以下划线中划线等都可以，这是由于es数据底层存储结构导致的。")]),s._v(" "),t("h3",{attrs:{id:"_2-1、文档数据模型介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1、文档数据模型介绍"}},[s._v("#")]),s._v(" 2.1、文档数据模型介绍")]),s._v(" "),t("ul",[t("li",[s._v("文档类型：")])]),s._v(" "),t("p",[s._v("json类型")]),s._v(" "),t("ul",[t("li",[s._v("元数据：")])]),s._v(" "),t("p",[s._v("_index：索引名称")]),s._v(" "),t("p",[s._v("_type：默认值"),t("code",[s._v("__doc")]),s._v("新版本固定下来")]),s._v(" "),t("p",[s._v("_id：数据的唯一标识，没有指定会自动生成")]),s._v(" "),t("p",[s._v("_version：数据的版本")]),s._v(" "),t("p",[s._v("_seqno：插入数据更新数据的顺序号，自增")]),s._v(" "),t("p",[s._v("_primary_term：主分片的顺序号，每次主从分片切换会增加，类似于"),t("code",[s._v("epoch")])]),s._v(" "),t("p",[s._v("其它（如查询的时候会返回一个"),t("code",[s._v("found")]),s._v("）")]),s._v(" "),t("ul",[t("li",[s._v("源数据")])]),s._v(" "),t("p",[s._v("json结构")]),s._v(" "),t("h3",{attrs:{id:"_2-2、平铺型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2、平铺型"}},[s._v("#")]),s._v(" 2.2、平铺型")]),s._v(" "),t("h4",{attrs:{id:"概念介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概念介绍"}},[s._v("#")]),s._v(" * 概念介绍")]),s._v(" "),t("p",[s._v("json对象平铺")]),s._v(" "),t("h4",{attrs:{id:"优点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[s._v("#")]),s._v(" * 优点")]),s._v(" "),t("p",[s._v("性能好，简单，效率高")]),s._v(" "),t("h4",{attrs:{id:"缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[s._v("#")]),s._v(" * 缺点")]),s._v(" "),t("p",[s._v("太简单，不太好表达结构")]),s._v(" "),t("h4",{attrs:{id:"应用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[s._v("#")]),s._v(" * 应用场景")]),s._v(" "),t("p",[s._v("复杂业务场景")]),s._v(" "),t("p",[s._v("复杂对象映射表达")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("POST qknavy_user_001/_doc\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"navy"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"email"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yuankunliu@126.com"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_2-3、对象型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3、对象型"}},[s._v("#")]),s._v(" 2.3、对象型")]),s._v(" "),t("h4",{attrs:{id:"概念介绍-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概念介绍-2"}},[s._v("#")]),s._v(" * 概念介绍")]),s._v(" "),t("p",[s._v("json结构对象嵌套")]),s._v(" "),t("h4",{attrs:{id:"优点-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优点-2"}},[s._v("#")]),s._v(" * 优点")]),s._v(" "),t("p",[s._v("表达能力好")]),s._v(" "),t("h4",{attrs:{id:"缺点-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缺点-2"}},[s._v("#")]),s._v(" * 缺点")]),s._v(" "),t("p",[s._v("结构复杂，不要超过三层")]),s._v(" "),t("h4",{attrs:{id:"应用场景-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用场景-2"}},[s._v("#")]),s._v(" * 应用场景")]),s._v(" "),t("p",[s._v("与数据表1-1对应")]),s._v(" "),t("p",[s._v("常规查询搜索")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("POST qknavy_user_001/_doc\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"navy"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"email"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yuankunliu@126.com"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"manager"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jerry"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"email"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jerry@aliyun.com"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"_2-4、数组型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4、数组型"}},[s._v("#")]),s._v(" 2.4、数组型")]),s._v(" "),t("h4",{attrs:{id:"概念介绍-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概念介绍-3"}},[s._v("#")]),s._v(" * 概念介绍")]),s._v(" "),t("p",[s._v("json数组对象")]),s._v(" "),t("h4",{attrs:{id:"优点-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优点-3"}},[s._v("#")]),s._v(" * 优点")]),s._v(" "),t("p",[s._v("表达能力强")]),s._v(" "),t("h4",{attrs:{id:"缺点-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缺点-3"}},[s._v("#")]),s._v(" * 缺点")]),s._v(" "),t("p",[s._v("效率不高，不好维护")]),s._v(" "),t("h4",{attrs:{id:"应用场景-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用场景-3"}},[s._v("#")]),s._v(" * 应用场景")]),s._v(" "),t("p",[s._v("常规的数据记录，比如记录一个家庭成员信息")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("POST qknavy_families_001/_doc\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"navy"')]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"families"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"大头儿子"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"小头爸爸"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"围裙妈妈"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h3",{attrs:{id:"_2-5、关联型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5、关联型"}},[s._v("#")]),s._v(" 2.5、关联型")]),s._v(" "),t("h4",{attrs:{id:"概念介绍-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概念介绍-4"}},[s._v("#")]),s._v(" * 概念介绍")]),s._v(" "),t("p",[s._v("父子关系：join字段类型")]),s._v(" "),t("p",[s._v("键值对关系：nested字段类型")]),s._v(" "),t("h4",{attrs:{id:"优点-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优点-4"}},[s._v("#")]),s._v(" * 优点")]),s._v(" "),t("p",[s._v("表达能力强")]),s._v(" "),t("h4",{attrs:{id:"缺点-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缺点-4"}},[s._v("#")]),s._v(" * 缺点")]),s._v(" "),t("p",[s._v("效率比较低")]),s._v(" "),t("p",[s._v("语法复杂一些")]),s._v(" "),t("p",[s._v("维护不是很方便，性能一般")]),s._v(" "),t("h4",{attrs:{id:"应用场景-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用场景-4"}},[s._v("#")]),s._v(" * 应用场景")]),s._v(" "),t("p",[s._v("问答场景、上下文关系")]),s._v(" "),t("p",[s._v("键值对关系")]),s._v(" "),t("h2",{attrs:{id:"_3、索引设计经验"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、索引设计经验"}},[s._v("#")]),s._v(" 3、索引设计经验")]),s._v(" "),t("ul",[t("li",[s._v("索引与分片与副本关系")])]),s._v(" "),t("p",[t("strong",[s._v("分片数量")]),s._v("：\n索引分片数不超过节点数量；1个索引40个分片等同于40个1分片索引")]),s._v(" "),t("p",[t("strong",[s._v("副本数量")]),s._v("：")]),s._v(" "),t("p",[s._v("索引副本数量少于节点数量；副本数量可多可少。")]),s._v(" "),t("ul",[t("li",[s._v("分片容量")])]),s._v(" "),t("p",[t("strong",[s._v("数据容量")]),s._v("：")]),s._v(" "),t("p",[s._v("分片数据容量上限不超过50GB，建议20GB-40GB")]),s._v(" "),t("p",[t("strong",[s._v("数据条数")]),s._v("：")]),s._v(" "),t("p",[s._v("单分片不超过2的32次方-1（21亿条）")]),s._v(" "),t("ul",[t("li",[s._v("数据模型设计原则")])]),s._v(" "),t("p",[t("strong",[s._v("简单模型原则")])]),s._v(" "),t("p",[s._v("能用平铺的模型搞定的，尽量平铺；对象深度建议不超过2级。")]),s._v(" "),t("p",[t("strong",[s._v("最细粒度原则")])]),s._v(" "),t("p",[s._v("对象嵌套遵循最细粒度原则，上层数据冗余处理。")]),s._v(" "),t("p",[t("strong",[s._v("多索引原则")])]),s._v(" "),t("p",[s._v("单一索引尽量满足单一业务场景；不同的业务场景索引及时数据模型相似也要分开。")]),s._v(" "),t("p",[t("strong",[s._v("大宽表索引原则")])]),s._v(" "),t("p",[s._v("特殊场景合并多个表时，尽量全部合并在一起；ES不支持join，大宽表课解决查询问题。")])])}),[],!1,null,null,null);a.default=r.exports}}]);