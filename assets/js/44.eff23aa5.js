(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{556:function(s,a,e){"use strict";e.r(a);var n=e(4),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[e("a",{attrs:{href:"https://blog.csdn.net/lishanleilixin/article/details/78384848",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考1"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("a",{attrs:{href:"https://www.jianshu.com/p/abe767dc4596",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考2"),e("OutboundLink")],1)]),s._v(" "),e("h2",{attrs:{id:"_1、安装git、golang-1-7及以上"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装git、golang-1-7及以上"}},[s._v("#")]),s._v(" 1、安装git、golang（1.7及以上）")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("git的安装太熟悉了，不赘述")])]),s._v(" "),e("li",[e("p",[s._v("如果golang版本过低，需要先卸载再重新安装")])])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" purge golang-go\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("【golang下载】wget https://dl.google.com/go/go1.12.5.linux-amd64.tar.gz")]),s._v(" "),e("ul",[e("li",[s._v("执行tar解压到/usr/loacl目录下（官方推荐），得到go文件夹等")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -C /usr/local -zxf go1.12.5.linux-amd64.tar.gz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("将/usr/loacl/go/bin目录到PATH变量中：")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/profile\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在最后一行添加")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOROOT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/go\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOROOT")]),s._v("/bin\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存退出后source一下（vim 的使用方法可以自己搜索一下）")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h2",{attrs:{id:"_2、下载、配置、编译"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、下载、配置、编译"}},[s._v("#")]),s._v(" 2、下载、配置、编译")]),s._v(" "),e("ul",[e("li",[s._v("1）下载ngrok")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/inconshreveable/ngrok.git\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入对应目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ngrok/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("2）生成证书文件")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置域名")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NGROK_DOMAIN")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx.xxx.com"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成证书文件")]),s._v("\nopenssl genrsa -out base.key "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\nopenssl req -new -x509 -nodes -key base.key -days "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" -subj "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/CN='),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NGROK_DOMAIN")]),s._v('"')]),s._v(" -out base.pem\nopenssl genrsa -out server.key "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\nopenssl req -new -key server.key -subj "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/CN='),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NGROK_DOMAIN")]),s._v('"')]),s._v(" -out server.csr\nopenssl x509 -req -in server.csr -CA base.pem -CAkey base.key -CAcreateserial -days "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v(" -out server.crt\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" base.pem assets/client/tls/ngrokroot.crt\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("ul",[e("li",[s._v("3）生成服务端程序")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" release-server\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("4）生成客户端程序（这里我需要Windows版本的，注意参数）")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOOS")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"windows"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOARCH")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"amd64"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" release-client\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("经过上述操作之后，在ngrock/bin目录下就会生成一个ngrokd 可执行文件和 windows_amd64文件夹，windows_amd64文件夹下面就是Windows版本的客户端，下载下来放到本地执行")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("5）运行")]),s._v(" "),e("ul",[e("li",[s._v("运行服务端")])]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./bin/ngrokd -tlsKey"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server.key -tlsCrt"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server.crt -domain"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx.xxx.com"')]),s._v(" -httpAddr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('":10081"')]),s._v(" -httpsAddr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('":10082"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("到这一步，ngrok 服务已经跑起来了，可以通过屏幕上显示的日志查看更多信息。httpAddr,httpsAddr分别是 ngrok 用来转发 http、https 服务的端口，可以随意指定")])])])]),s._v(" "),e("p",[s._v('ngrokd 还会开一个 4443 端口用来跟客户端通讯（可通过 -tunnelAddr=":xxx" 指定），如果你配置了 iptables 规则，需要放行这三个端口上的 TCP 协议')]),s._v(" "),e("ul",[e("li",[s._v("6）配置客户端")])]),s._v(" "),e("p",[e("code",[s._v("ngrok.cfg")]),s._v("文件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('server_addr: "[xxx.xxx.com:4443]" \ntrust_host_root_certs: false\ntunnels:\nxyz:\n proto:\n  http: 192.168.0.100:8080\n subdomain: xyz\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[e("code",[s._v("start.bat")]),s._v("文件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ngrok -config=ngrok.cfg -log=ngrok.log start xyz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("其中ngrok.cfg文件配置了映射关系，暴露局域网内什么协议端口，start.bat定义启动配置的tunnels")]),s._v(" "),e("p",[s._v("【参考】：https://www.jianshu.com/p/cd937631a88b")]),s._v(" "),e("h2",{attrs:{id:"_3、结合nginx反向代理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、结合nginx反向代理"}},[s._v("#")]),s._v(" 3、结合nginx反向代理")]),s._v(" "),e("p",[s._v("在ngrok所在的远程服务器上配置nginx反向代理，将我们的域名映射到对应的服务上，在启动"),e("code",[s._v("nginx")]),s._v("、"),e("code",[s._v("ngrok服务端")]),s._v("以及本地启动"),e("code",[s._v("ngrok客户端")]),s._v("之后，我们再将要暴露的服务暴露在客户端"),e("code",[s._v("ngrok.cfg")]),s._v("文件上配置的端口上，比如这里是8080端口，我们可以将springboot应用运行在这个端口之上，这样就可以通过广域网访问"),e("code",[s._v("http://xyz.xxx.xxx.com")]),s._v("访问到我们本地的服务")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server{\n    listen 80;\n    server_name xyz.xxx.xxx.com;\n    location / {\n        #proxy_set_header X-Real-IP $remote_addr;\n        #proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $host:10081;  # 这个是重点，$host 指的是与server_name相同的域名\n        proxy_redirect off;\n        client_max_body_size 10m;\n        client_body_buffer_size 128k;\n        proxy_connect_timeout 90;\n        proxy_read_timeout 90;\n        proxy_buffer_size 4k;\n        proxy_buffers 6 128k;\n        proxy_busy_buffers_size 256k;\n        proxy_temp_file_write_size 256k;\n        proxy_pass http://localhost:10081;\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("blockquote",[e("p",[s._v("注意域名要解析到nginx所在的这个远程服务器ip上")])])])}),[],!1,null,null,null);a.default=t.exports}}]);