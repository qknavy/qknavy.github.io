<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <link rel="icon" href="https://qknavy.oss-cn-huhehaote.aliyuncs.com/%E5%9B%BE%E7%89%87/logo-green-1000.png"><title>5、分布式事务Seata源码学习</title><meta name="description" content="终有一天，你会感谢今天努力的自己！">
    <link rel="preload" href="/assets/style-DRXNKcOj.css" as="style"><link rel="stylesheet" href="/assets/style-DRXNKcOj.css">
    <link rel="modulepreload" href="/assets/app-CUmx0lpF.js"><link rel="modulepreload" href="/assets/05fenbushishiwuSeatayuanmaxuexi.html-CsSFNJee.js">
    <link rel="prefetch" href="/assets/timeline.html-Cnz6yiyh.js" as="script"><link rel="prefetch" href="/assets/posts.html-C9HjsMiq.js" as="script"><link rel="prefetch" href="/assets/friendship-link.html-CDgwsf3W.js" as="script"><link rel="prefetch" href="/assets/1.html-CT0KcB7o.js" as="script"><link rel="prefetch" href="/assets/1.html-D9zjRQJZ.js" as="script"><link rel="prefetch" href="/assets/1.html-he2ABRUn.js" as="script"><link rel="prefetch" href="/assets/1.html-BLLw3rUQ.js" as="script"><link rel="prefetch" href="/assets/1.html-D8ATgHbv.js" as="script"><link rel="prefetch" href="/assets/1.html-BcLMX6oH.js" as="script"><link rel="prefetch" href="/assets/1.html-7cu4TyjC.js" as="script"><link rel="prefetch" href="/assets/1.html-Osob1rTy.js" as="script"><link rel="prefetch" href="/assets/1.html-BLMKTrDc.js" as="script"><link rel="prefetch" href="/assets/1.html-CZ7yWlcY.js" as="script"><link rel="prefetch" href="/assets/1.html-DHlnWzVf.js" as="script"><link rel="prefetch" href="/assets/1.html-DdJcP7ci.js" as="script"><link rel="prefetch" href="/assets/1.html-JXbGRMBR.js" as="script"><link rel="prefetch" href="/assets/1.html-CHMGyLj8.js" as="script"><link rel="prefetch" href="/assets/1.html-CQ7qu5te.js" as="script"><link rel="prefetch" href="/assets/1.html-DmG8Eqal.js" as="script"><link rel="prefetch" href="/assets/1.html-Cu2j51x3.js" as="script"><link rel="prefetch" href="/assets/1.html-Be6bsrCg.js" as="script"><link rel="prefetch" href="/assets/1.html-CZcV6EHJ.js" as="script"><link rel="prefetch" href="/assets/1.html-4RdQiVs-.js" as="script"><link rel="prefetch" href="/assets/1.html-DyoVZIQc.js" as="script"><link rel="prefetch" href="/assets/1.html-F6gDY0XY.js" as="script"><link rel="prefetch" href="/assets/1.html-BEM7RZ3W.js" as="script"><link rel="prefetch" href="/assets/1.html-NihcquVF.js" as="script"><link rel="prefetch" href="/assets/1.html-C8rerZbF.js" as="script"><link rel="prefetch" href="/assets/1.html-Bmb3NQRz.js" as="script"><link rel="prefetch" href="/assets/1.html-Bg17Y-Z_.js" as="script"><link rel="prefetch" href="/assets/1.html-gguR3Erz.js" as="script"><link rel="prefetch" href="/assets/1.html-CyC_pXrt.js" as="script"><link rel="prefetch" href="/assets/1.html-Cs_eOuY6.js" as="script"><link rel="prefetch" href="/assets/1.html-DYHmZAha.js" as="script"><link rel="prefetch" href="/assets/1.html-HJsdBFvT.js" as="script"><link rel="prefetch" href="/assets/1.html-G-6gXphk.js" as="script"><link rel="prefetch" href="/assets/1.html-Cpq_88ml.js" as="script"><link rel="prefetch" href="/assets/2.html-CtC508MU.js" as="script"><link rel="prefetch" href="/assets/3.html-DIHzLgQS.js" as="script"><link rel="prefetch" href="/assets/4.html-DuFrofci.js" as="script"><link rel="prefetch" href="/assets/5.html-B8jhZJK1.js" as="script"><link rel="prefetch" href="/assets/6.html-D1zhIxu1.js" as="script"><link rel="prefetch" href="/assets/7.html-Cf-VhIhs.js" as="script"><link rel="prefetch" href="/assets/index.html-BaMqsjD1.js" as="script"><link rel="prefetch" href="/assets/changjianxiaoxizhongjianjianzhongdeshiwuxiaoxi.html-CvNhD0JL.js" as="script"><link rel="prefetch" href="/assets/index.html-DeuHJZ-H.js" as="script"><link rel="prefetch" href="/assets/index.html-B6TwTlgF.js" as="script"><link rel="prefetch" href="/assets/index.html-CzdF9OQZ.js" as="script"><link rel="prefetch" href="/assets/index.html-BMGlYx9O.js" as="script"><link rel="prefetch" href="/assets/index.html-8QAFWF8m.js" as="script"><link rel="prefetch" href="/assets/index.html-l7smO87l.js" as="script"><link rel="prefetch" href="/assets/index.html-8n00YSh-.js" as="script"><link rel="prefetch" href="/assets/index.html-DeMsiOQR.js" as="script"><link rel="prefetch" href="/assets/index.html-b4fjxxe5.js" as="script"><link rel="prefetch" href="/assets/index.html-YZfFVEqL.js" as="script"><link rel="prefetch" href="/assets/index.html-C758CCnj.js" as="script"><link rel="prefetch" href="/assets/index.html-D91NiH3D.js" as="script"><link rel="prefetch" href="/assets/Javaxunijideleijiazaijizhi.html-4-6DjY1s.js" as="script"><link rel="prefetch" href="/assets/index.html-NwizPh03.js" as="script"><link rel="prefetch" href="/assets/index.html-BXfq-PB1.js" as="script"><link rel="prefetch" href="/assets/index.html-DbR6jv1d.js" as="script"><link rel="prefetch" href="/assets/index.html-CoyWIIGs.js" as="script"><link rel="prefetch" href="/assets/index.html-Dz_x3bk-.js" as="script"><link rel="prefetch" href="/assets/index.html-BSXtR4Ud.js" as="script"><link rel="prefetch" href="/assets/index.html-DlxysbQf.js" as="script"><link rel="prefetch" href="/assets/index.html-BiPBSqtc.js" as="script"><link rel="prefetch" href="/assets/01MinIOdajianzijideduixiangcunchufuwuqi.html-ntGlyx_3.js" as="script"><link rel="prefetch" href="/assets/index.html-UXmsq-cU.js" as="script"><link rel="prefetch" href="/assets/k8shuanjingxiadajianrabbitmqjiqun.html-C2-3Td7G.js" as="script"><link rel="prefetch" href="/assets/index.html-BHl6MsFo.js" as="script"><link rel="prefetch" href="/assets/index.html-CaKMebl5.js" as="script"><link rel="prefetch" href="/assets/01renshiMySQL.html-Cr9QzCnW.js" as="script"><link rel="prefetch" href="/assets/02MySQLcunchuyinqingjieshao.html-BJ8G_-pB.js" as="script"><link rel="prefetch" href="/assets/03InnoDBsuoyinjiegouheyuanli.html-DGSKFEhv.js" as="script"><link rel="prefetch" href="/assets/04MySQLsuoyinyouhua.html-Bqzy4ElC.js" as="script"><link rel="prefetch" href="/assets/05MySQLshiwutexingheshiwugelijibie.html-74iCgaVR.js" as="script"><link rel="prefetch" href="/assets/06MySQLduobanbenkongzhi(MVCC)hesuo.html-CMf8ufCp.js" as="script"><link rel="prefetch" href="/assets/index.html-7zguHI47.js" as="script"><link rel="prefetch" href="/assets/01Redisdeanzhuangbushu.html-9iYYa2DI.js" as="script"><link rel="prefetch" href="/assets/02Redischangyongshujuleixingyijishiyongchangjing.html-xKc1SyN9.js" as="script"><link rel="prefetch" href="/assets/01fenbushishiwudebeijinghejiejuefangan.html-bRB7pacR.js" as="script"><link rel="prefetch" href="/assets/02fenbushishiwuSeatadeyingyongyuyuanlifenxi.html-BHAdMEuH.js" as="script"><link rel="prefetch" href="/assets/03fenbushishiwujiejuefanganSeatachutiyan.html-BO-zE7lg.js" as="script"><link rel="prefetch" href="/assets/04fenbushishiwuSeatadegaojiyingyongxiangjie.html-CfekOdbT.js" as="script"><link rel="prefetch" href="/assets/index.html-iIrDXBZe.js" as="script"><link rel="prefetch" href="/assets/index.html-UIYQwZIb.js" as="script"><link rel="prefetch" href="/assets/DockeryijianbushuSolaraquanwangwusunyinlesuibianting.html-DKUJXJtv.js" as="script"><link rel="prefetch" href="/assets/index.html-KqFFk7Pw.js" as="script"><link rel="prefetch" href="/assets/index.html-DpNZ64Ha.js" as="script"><link rel="prefetch" href="/assets/index.html-CKGCDRWi.js" as="script"><link rel="prefetch" href="/assets/index.html-CTwKCFfK.js" as="script"><link rel="prefetch" href="/assets/index.html-DTIhJk-d.js" as="script"><link rel="prefetch" href="/assets/index.html-Cv4kDlBa.js" as="script"><link rel="prefetch" href="/assets/index.html-CrL_g3cM.js" as="script"><link rel="prefetch" href="/assets/index.html-CU-bzMTK.js" as="script"><link rel="prefetch" href="/assets/index.html-Do1FniES.js" as="script"><link rel="prefetch" href="/assets/index.html-DDdxczJi.js" as="script"><link rel="prefetch" href="/assets/index.html-D-AH_YWP.js" as="script"><link rel="prefetch" href="/assets/index.html-CrzoAjju.js" as="script"><link rel="prefetch" href="/assets/index.html-BdQwO7ME.js" as="script"><link rel="prefetch" href="/assets/index.html-CLZdXHJv.js" as="script"><link rel="prefetch" href="/assets/index.html--2j2ReJX.js" as="script"><link rel="prefetch" href="/assets/index.html-DlQ01QBI.js" as="script"><link rel="prefetch" href="/assets/fastexcelduxieExcel.html-DkTk5cZ2.js" as="script"><link rel="prefetch" href="/assets/jiyumobanyinqingshixianyemianjingtaihua.html-cdp3KlNb.js" as="script"><link rel="prefetch" href="/assets/Arthasjibenyongfazhinan.html-BQh5AL9H.js" as="script"><link rel="prefetch" href="/assets/JavaAgentdeshiyongheyuanli.html-nBWuLT9y.js" as="script"><link rel="prefetch" href="/assets/404.html-DcIwk_uF.js" as="script"><link rel="prefetch" href="/assets/Valine.min-_LyT3bfY.js" as="script"><link rel="prefetch" href="/assets/giscus-aTimukGI-DWEKOTfS.js" as="script"><link rel="prefetch" href="/assets/IconArchitecture-DiMtYGpB.js" as="script"><link rel="prefetch" href="/assets/IconCategory-Cid24n-e.js" as="script"><link rel="prefetch" href="/assets/IconCICD-CG9Suqgx.js" as="script"><link rel="prefetch" href="/assets/IconCloud-BDA16Hcq.js" as="script"><link rel="prefetch" href="/assets/IconCode-fX8U9cxy.js" as="script"><link rel="prefetch" href="/assets/IconCompute-Tl5vUyVe.js" as="script"><link rel="prefetch" href="/assets/IconConcurrent-C6oTVz9w.js" as="script"><link rel="prefetch" href="/assets/IconContainer-CJ5-51zZ.js" as="script"><link rel="prefetch" href="/assets/IconDB-Dz1jDMpS.js" as="script"><link rel="prefetch" href="/assets/IconDevOpts-DsYk-Mnm.js" as="script"><link rel="prefetch" href="/assets/IconDistribute-BS3YqTHe.js" as="script"><link rel="prefetch" href="/assets/IconDocument-Ce4gvJ3y.js" as="script"><link rel="prefetch" href="/assets/IconDownload-D3LuA5Do.js" as="script"><link rel="prefetch" href="/assets/IconDrone-G1j0ly_H.js" as="script"><link rel="prefetch" href="/assets/IconHome-gtQRQQ8g.js" as="script"><link rel="prefetch" href="/assets/IconJava-vSlJXYyJ.js" as="script"><link rel="prefetch" href="/assets/IconJavaFundation-1zWhAybe.js" as="script"><link rel="prefetch" href="/assets/IconJVM-BEkAatGr.js" as="script"><link rel="prefetch" href="/assets/IconLanguage-DCPNsRaw.js" as="script"><link rel="prefetch" href="/assets/IconMicroService-CXcVmjEr.js" as="script"><link rel="prefetch" href="/assets/IconMovie-Dp24nBQP.js" as="script"><link rel="prefetch" href="/assets/IconMQ-CrEStFPG.js" as="script"><link rel="prefetch" href="/assets/IconNosql-v5CfNx8H.js" as="script"><link rel="prefetch" href="/assets/IconOptimizing-BLuAziCM.js" as="script"><link rel="prefetch" href="/assets/IconOS-BWYRox0G.js" as="script"><link rel="prefetch" href="/assets/IconOther-gRDWJK74.js" as="script"><link rel="prefetch" href="/assets/IconTag-BC0qzPDe.js" as="script"><link rel="prefetch" href="/assets/IconTools-DBGdW3L_.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container show-series show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="https://qknavy.oss-cn-huhehaote.aliyuncs.com/%E5%9B%BE%E7%89%87/logo-green-1000.png" alt=""><!----></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/" class="link" aria-label="首页"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16.612 2.214a1.01 1.01 0 0 0-1.242 0L1 13.419l1.243 1.572L4 13.621V26a2.004 2.004 0 0 0 2 2h20a2.004 2.004 0 0 0 2-2V13.63L29.757 15L31 13.428zM18 26h-4v-8h4zm2 0v-8a2.002 2.002 0 0 0-2-2h-4a2.002 2.002 0 0 0-2 2v8H6V12.062l10-7.79l10 7.8V26z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->首页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="Java基础"><span class="xicon-container left title"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 384 512" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3c-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 53.2 242.84 0 242.84 0c21.5 84.5-75.6 110.1-110.7 162.6c-23.9 35.9 11.7 74.4 60.2 118.2zm114.6-176.2c.1 0-175.2 43.8-91.5 140.2c24.7 28.4-6.5 54-6.5 54s62.7-32.4 33.9-72.9c-26.9-37.8-47.5-56.6 64.1-121.3zm-6.1 270.5a12.19 12.19 0 0 1-2 2.6c128.3-33.7 81.1-118.9 19.8-97.3a17.33 17.33 0 0 0-8.2 6.3a70.45 70.45 0 0 1 11-3c31-6.5 75.5 41.5-20.6 91.4zM348 437.4s14.5 11.9-15.9 21.2c-57.9 17.5-240.8 22.8-291.6.7c-18.3-7.9 16-19 26.8-21.3c11.2-2.4 17.7-2 17.7-2c-20.3-14.3-131.3 28.1-56.4 40.2C232.84 509.4 401 461.3 348 437.4zM124.44 396c-78.7 22 47.9 67.4 148.1 24.5a185.89 185.89 0 0 1-28.2-13.8c-44.7 8.5-65.4 9.1-106 4.5c-33.5-3.8-13.9-15.2-13.9-15.2zm179.8 97.2c-78.7 14.8-175.8 13.1-233.3 3.6c0-.1 11.8 9.7 72.4 13.6c92.2 5.9 233.8-3.3 237.1-46.9c0 0-6.4 16.5-76.2 29.7zM260.64 353c-59.2 11.4-93.5 11.1-136.8 6.6c-33.5-3.5-11.6-19.7-11.6-19.7c-86.8 28.8 48.2 61.4 169.5 25.9a60.37 60.37 0 0 1-21.1-12.8z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Java基础<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="Java基础"><span class="title"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 384 512" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3c-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 53.2 242.84 0 242.84 0c21.5 84.5-75.6 110.1-110.7 162.6c-23.9 35.9 11.7 74.4 60.2 118.2zm114.6-176.2c.1 0-175.2 43.8-91.5 140.2c24.7 28.4-6.5 54-6.5 54s62.7-32.4 33.9-72.9c-26.9-37.8-47.5-56.6 64.1-121.3zm-6.1 270.5a12.19 12.19 0 0 1-2 2.6c128.3-33.7 81.1-118.9 19.8-97.3a17.33 17.33 0 0 0-8.2 6.3a70.45 70.45 0 0 1 11-3c31-6.5 75.5 41.5-20.6 91.4zM348 437.4s14.5 11.9-15.9 21.2c-57.9 17.5-240.8 22.8-291.6.7c-18.3-7.9 16-19 26.8-21.3c11.2-2.4 17.7-2 17.7-2c-20.3-14.3-131.3 28.1-56.4 40.2C232.84 509.4 401 461.3 348 437.4zM124.44 396c-78.7 22 47.9 67.4 148.1 24.5a185.89 185.89 0 0 1-28.2-13.8c-44.7 8.5-65.4 9.1-106 4.5c-33.5-3.8-13.9-15.2-13.9-15.2zm179.8 97.2c-78.7 14.8-175.8 13.1-233.3 3.6c0-.1 11.8 9.7 72.4 13.6c92.2 5.9 233.8-3.3 237.1-46.9c0 0-6.4 16.5-76.2 29.7zM260.64 353c-59.2 11.4-93.5 11.1-136.8 6.6c-33.5-3.5-11.6-19.7-11.6-19.7c-86.8 28.8 48.2 61.4 169.5 25.9a60.37 60.37 0 0 1-21.1-12.8z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Java基础<!--]--></span></span></span><span class="right arrow"></span></button><ul class="dropdown-link__container" style="display:none;"><!--[--><li class="dropdown-link__item"><a href="/series/java/" class="link" aria-label="Java基础"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 384 512" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3c-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 53.2 242.84 0 242.84 0c21.5 84.5-75.6 110.1-110.7 162.6c-23.9 35.9 11.7 74.4 60.2 118.2zm114.6-176.2c.1 0-175.2 43.8-91.5 140.2c24.7 28.4-6.5 54-6.5 54s62.7-32.4 33.9-72.9c-26.9-37.8-47.5-56.6 64.1-121.3zm-6.1 270.5a12.19 12.19 0 0 1-2 2.6c128.3-33.7 81.1-118.9 19.8-97.3a17.33 17.33 0 0 0-8.2 6.3a70.45 70.45 0 0 1 11-3c31-6.5 75.5 41.5-20.6 91.4zM348 437.4s14.5 11.9-15.9 21.2c-57.9 17.5-240.8 22.8-291.6.7c-18.3-7.9 16-19 26.8-21.3c11.2-2.4 17.7-2 17.7-2c-20.3-14.3-131.3 28.1-56.4 40.2C232.84 509.4 401 461.3 348 437.4zM124.44 396c-78.7 22 47.9 67.4 148.1 24.5a185.89 185.89 0 0 1-28.2-13.8c-44.7 8.5-65.4 9.1-106 4.5c-33.5-3.8-13.9-15.2-13.9-15.2zm179.8 97.2c-78.7 14.8-175.8 13.1-233.3 3.6c0-.1 11.8 9.7 72.4 13.6c92.2 5.9 233.8-3.3 237.1-46.9c0 0-6.4 16.5-76.2 29.7zM260.64 353c-59.2 11.4-93.5 11.1-136.8 6.6c-33.5-3.5-11.6-19.7-11.6-19.7c-86.8 28.8 48.2 61.4 169.5 25.9a60.37 60.37 0 0 1-21.1-12.8z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Java基础<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/juc/" class="link" aria-label="Java并发编程"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 20 20" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><g fill="none"><path d="M14.854 2.146a.5.5 0 0 0-.708.708L16.293 5H11.5A2.5 2.5 0 0 0 9 7.5v6A1.5 1.5 0 0 1 7.5 15h-.55a2.5 2.5 0 1 0 0 1h.55a2.5 2.5 0 0 0 2.5-2.5v-6A1.5 1.5 0 0 1 11.5 6h4.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3zM6 15.5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0zm5-3a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5v-4zm8 2a.5.5 0 0 0-1 0V17a1 1 0 0 1-1 1h-3.5a.5.5 0 0 0 0 1H17a2 2 0 0 0 2-2v-2.5z" fill="currentColor"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Java并发编程<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/jvm/Java虚拟机的类加载机制.md" class="link" aria-label="JVM优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="800" height="800" viewbox="100 100 500.000000 500.000000" preserveaspectratio="xMidYMid meet" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><metadata><!----></metadata><g transform="translate(0.000000,800.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"><path d="M2989 5878 c-97 -84 -298 -259 -447 -388 l-272 -235 0 -1445 c0 -1570 -3 -1497 55 -1609 51 -101 159 -185 280 -217 41 -11 304 -14 1395 -14 1177 0 1353 2 1405 15 163 43 284 171 315 335 15 78 14 3292 -1 3362 -33 154 -178 302 -318 324 -23 4 -44 11 -47 15 -3 5 -490 9 -1097 9 l-1092 0 -176 -152z m2427 -55 c54 -29 117 -101 132 -151 9 -29 12 -452 12 -1683 l0 -1644 -24 -50 c-27 -58 -65 -99 -121 -129 l-40 -21 -1350 -3 c-1221 -2 -1355 -1 -1400 14 -67 22 -115 62 -151 126 l-29 53 -3 1422 -2 1422 37 34 c21 19 94 83 163 142 69 59 217 187 330 284 113 97 211 180 218 185 9 6 12 -70 12 -368 l0 -376 -242 -2 -243 -3 0 -80 0 -80 307 -3 c297 -2 308 -2 328 18 19 19 20 32 20 470 l0 450 1003 -2 1002 -3 41 -22z"></path><path d="M3068 3932 l-3 -359 -27 -35 c-17 -22 -46 -43 -73 -53 -44 -17 -47 -17 -111 4 -37 12 -67 20 -68 19 -1 -2 -16 -34 -34 -72 -39 -81 -39 -82 53 -111 79 -24 194 -18 259 15 62 32 119 97 148 169 22 55 23 65 23 416 l0 360 -82 3 -82 3 -3 -359z"></path><path d="M3375 4262 c6 -29 97 -318 227 -719 l72 -223 85 0 86 0 68 213 c38 116 106 330 153 474 46 143 84 266 84 272 0 8 -27 11 -86 9 l-86 -3 -67 -210 c-36 -115 -84 -267 -106 -337 -22 -70 -43 -128 -46 -128 -3 0 -23 55 -44 123 -21 67 -50 160 -65 207 -16 47 -47 145 -70 218 l-42 132 -85 0 -85 0 7 -28z"></path><path d="M4290 4270 c-19 -19 -20 -33 -20 -485 l0 -465 80 0 80 0 2 288 3 287 93 -187 c74 -151 98 -191 122 -203 43 -22 94 -19 125 8 14 12 68 108 119 212 l94 190 1 -297 1 -298 80 0 80 0 0 468 c0 533 5 502 -83 502 -96 0 -80 24 -309 -460 l-50 -105 -133 272 c-145 296 -143 293 -226 293 -26 0 -46 -7 -59 -20z"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->JVM优化<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/tools/" class="link" aria-label="小工具"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="800.000000" height="800.000000" viewbox="100 100 500.000000 500.000000" preserveaspectratio="xMidYMid meet" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><metadata><!----></metadata><g transform="translate(0.000000,800.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"><path d="M4716 6274 c-263 -41 -480 -149 -661 -329 -91 -90 -129 -141 -179 -241 -73 -148 -96 -287 -96 -592 0 -238 13 -351 55 -496 107 -368 455 -719 845 -854 96 -33 114 -36 215 -36 134 0 232 27 400 109 192 93 407 269 556 455 134 165 173 279 173 505 0 164 -14 254 -63 398 -65 189 -108 247 -179 247 -57 -1 -80 -15 -248 -154 l-157 -130 -204 208 c-112 114 -203 211 -203 216 0 5 83 90 184 191 102 100 192 197 202 217 40 85 -7 194 -107 245 -104 53 -338 72 -533 41z m415 -171 c96 -33 95 -33 -101 -226 -226 -222 -230 -226 -230 -292 0 -40 6 -61 29 -96 40 -59 482 -499 504 -500 92 -7 84 -12 351 209 l76 64 20 -45 c32 -71 69 -223 82 -334 13 -116 2 -225 -34 -320 -44 -120 -250 -348 -424 -471 -119 -85 -267 -156 -388 -187 -122 -31 -133 -31 -242 0 -343 100 -682 424 -777 745 -48 161 -51 191 -51 470 0 236 3 275 22 351 37 153 87 241 198 353 158 159 371 262 610 295 99 14 292 5 355 -16z"></path><path d="M4570 5031 c-61 -12 -141 -63 -176 -111 -97 -132 -81 -298 39 -406 152 -136 396 -77 470 114 26 65 22 175 -7 237 -57 120 -200 193 -326 166z m128 -181 c35 -21 62 -72 62 -115 0 -65 -67 -135 -129 -135 -35 0 -86 26 -109 55 -27 34 -30 119 -6 154 42 59 122 77 182 41z"></path><path d="M2789 3383 c-456 -457 -747 -755 -763 -784 -14 -25 -35 -81 -46 -125 -18 -68 -19 -88 -10 -148 21 -134 86 -259 191 -366 190 -192 448 -283 669 -236 240 52 396 195 483 444 30 86 31 89 36 359 l6 273 379 379 380 380 -54 58 c-30 32 -55 60 -56 61 -1 2 -176 -168 -388 -378 -261 -259 -392 -396 -406 -424 -18 -39 -20 -61 -20 -288 0 -211 -3 -255 -20 -322 -52 -204 -177 -335 -364 -381 -222 -54 -522 109 -635 345 -31 64 -36 85 -36 145 0 128 -31 92 781 900 l734 730 -58 58 c-32 31 -60 57 -62 57 -3 0 -336 -332 -741 -737z"></path><path d="M2613 2541 c-131 -60 -130 -252 1 -312 87 -39 175 -13 222 66 50 87 17 202 -72 245 -50 25 -97 25 -151 1z"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->小工具<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="开源与算法"><span class="xicon-container left title"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 640 512" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->开源与算法<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="开源与算法"><span class="title"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 640 512" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->开源与算法<!--]--></span></span></span><span class="right arrow"></span></button><ul class="dropdown-link__container" style="display:none;"><!--[--><li class="dropdown-link__item"><a href="/series/codes/" class="link" aria-label="开源框架"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 640 512" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->开源框架<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/algorithm/" class="link" aria-label="算法"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->算法<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="数据库"><span class="xicon-container left title"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="6" rx="8" ry="3"></ellipse><path d="M4 6v6a8 3 0 0 0 16 0V6"></path><path d="M4 12v6a8 3 0 0 0 16 0v-6"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据库<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="数据库"><span class="title"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="6" rx="8" ry="3"></ellipse><path d="M4 6v6a8 3 0 0 0 16 0V6"></path><path d="M4 12v6a8 3 0 0 0 16 0v-6"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据库<!--]--></span></span></span><span class="right arrow"></span></button><ul class="dropdown-link__container" style="display:none;"><!--[--><li class="dropdown-link__item"><a href="/series/db/" class="link" aria-label="关系型数据库"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="6" rx="8" ry="3"></ellipse><path d="M4 6v6a8 3 0 0 0 16 0V6"></path><path d="M4 12v6a8 3 0 0 0 16 0v-6"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->关系型数据库<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/nosql/" class="link" aria-label="非关系型数据库"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><g fill="none"><path d="M4 6c0-.69.315-1.293.774-1.78c.455-.482 1.079-.883 1.793-1.202C7.996 2.377 9.917 2 12 2c2.083 0 4.004.377 5.433 1.018c.714.32 1.338.72 1.793 1.202c.459.487.774 1.09.774 1.78v6.257a5.496 5.496 0 0 0-1.5-.882V8.392c-.32.22-.68.417-1.067.59C16.004 9.623 14.083 10 12 10c-2.083 0-4.004-.377-5.433-1.018a6.801 6.801 0 0 1-1.067-.59V18c0 .207.09.46.365.75c.279.296.717.596 1.315.864c1.195.535 2.899.886 4.82.886c.24 0 .476-.006.708-.016a5.495 5.495 0 0 0 2.15 1.267c-.89.162-1.856.249-2.858.249c-2.083 0-4.004-.377-5.433-1.017c-.714-.32-1.338-.72-1.793-1.203C4.315 19.293 4 18.69 4 18V6zm1.5 0c0 .207.09.46.365.75c.279.296.717.596 1.315.864c1.195.535 2.899.886 4.82.886c1.921 0 3.625-.35 4.82-.886c.598-.268 1.036-.568 1.315-.864c.275-.29.365-.543.365-.75c0-.207-.09-.46-.365-.75c-.279-.296-.717-.596-1.315-.864C15.625 3.851 13.92 3.5 12 3.5c-1.921 0-3.625.35-4.82.886c-.598.268-1.036.568-1.315.864c-.275.29-.365.543-.365.75zm11 15a4.48 4.48 0 0 0 2.607-.832l2.613 2.612a.75.75 0 1 0 1.06-1.06l-2.612-2.613A4.5 4.5 0 1 0 16.5 21zm0-1.5a3 3 0 1 1 0-6a3 3 0 0 1 0 6z" fill="currentColor"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->非关系型数据库<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title--active dropdown-link__title" type="button" aria-label="微服务架构"><span class="xicon-container left title"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M27.798 10a10 10 0 0 0-19.62.124A7.496 7.496 0 0 0 9.5 25H11v-2H9.5a5.496 5.496 0 0 1-.377-10.98l.837-.057l.09-.833A7.993 7.993 0 0 1 25.736 10z" fill="currentColor"></path><path d="M27 24a2.972 2.972 0 0 0-1.925.719l-4.101-2.461c.007-.086.026-.17.026-.258s-.019-.17-.026-.257l4.102-2.46A2.971 2.971 0 0 0 27 20a3.021 3.021 0 1 0-2.943-2.438l-3.912 2.347a3 3 0 1 0-.001 4.183l3.913 2.348A2.998 2.998 0 1 0 27 24zm0-8a1 1 0 1 1-1 1a1 1 0 0 1 1-1zm-9 7a1 1 0 1 1 1-1a1 1 0 0 1-1 1zm9 5a1 1 0 1 1 1-1a1 1 0 0 1-1 1z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务架构<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="微服务架构"><span class="title"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M27.798 10a10 10 0 0 0-19.62.124A7.496 7.496 0 0 0 9.5 25H11v-2H9.5a5.496 5.496 0 0 1-.377-10.98l.837-.057l.09-.833A7.993 7.993 0 0 1 25.736 10z" fill="currentColor"></path><path d="M27 24a2.972 2.972 0 0 0-1.925.719l-4.101-2.461c.007-.086.026-.17.026-.258s-.019-.17-.026-.257l4.102-2.46A2.971 2.971 0 0 0 27 20a3.021 3.021 0 1 0-2.943-2.438l-3.912 2.347a3 3 0 1 0-.001 4.183l3.913 2.348A2.998 2.998 0 1 0 27 24zm0-8a1 1 0 1 1-1 1a1 1 0 0 1 1-1zm-9 7a1 1 0 1 1 1-1a1 1 0 0 1-1 1zm9 5a1 1 0 1 1 1-1a1 1 0 0 1-1 1z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务架构<!--]--></span></span></span><span class="right arrow"></span></button><ul class="dropdown-link__container" style="display:none;"><!--[--><li class="dropdown-link__item"><a href="/series/distribution/" class="link" aria-label="分布式"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M24 10h-1V2h-2v8h-1a2.002 2.002 0 0 0-2 2v8a2.002 2.002 0 0 0 2 2h1v8h2v-8h1a2.002 2.002 0 0 0 2-2v-8a2.002 2.002 0 0 0-2-2zm0 10h-4v-8h4z" fill="currentColor"></path><path d="M12 6h-1V2H9v4H8a2.002 2.002 0 0 0-2 2v16a2.002 2.002 0 0 0 2 2h1v4h2v-4h1a2.002 2.002 0 0 0 2-2V8a2.002 2.002 0 0 0-2-2zm0 18H8V8h4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分布式<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/springcloud/" class="link" aria-label="SpringCloud"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M23.5 22H23v-2h.5a4.5 4.5 0 0 0 .36-9H23l-.1-.82a7 7 0 0 0-13.88 0L9 11h-.86a4.5 4.5 0 0 0 .36 9H9v2h-.5A6.5 6.5 0 0 1 7.2 9.14a9 9 0 0 1 17.6 0A6.5 6.5 0 0 1 23.5 22z" fill="currentColor"></path><path d="M17 26.17V14h-2v12.17l-2.59-2.58L11 25l5 5l5-5l-1.41-1.41L17 26.17z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->SpringCloud<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/mq/" class="link" aria-label="MQ"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20l-3-3H7a3 3 0 0 1-3-3V8a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3h-2l-3 3"></path><path d="M8 9h8"></path><path d="M8 13h6"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MQ<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/architecture/" class="link" aria-label="架构设计"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><circle cx="25" cy="20" r="1" fill="currentColor"></circle><path d="M19.414 30H15v-4.414l5.034-5.034A4.607 4.607 0 0 1 20 20a5 5 0 1 1 4.448 4.966zM17 28h1.586l5.206-5.206l.54.124a3.035 3.035 0 1 0-2.25-2.25l.124.54L17 26.414z" fill="currentColor"></path><path d="M6 8h2v8H6z" fill="currentColor"></path><path d="M2 8h2v8H2z" fill="currentColor"></path><path d="M18 8h2v6h-2z" fill="currentColor"></path><path d="M14 16h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2zm-2-2h2v-4h-2z" fill="currentColor"></path><path d="M2 18h2v8H2z" fill="currentColor"></path><path d="M14 18h2v4h-2z" fill="currentColor"></path><path d="M10 26H8a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2zm-2-2h2v-4H8z" fill="currentColor"></path><path d="M2 2h2v4H2z" fill="currentColor"></path><path d="M14 2h2v4h-2z" fill="currentColor"></path><path d="M18 2h2v4h-2z" fill="currentColor"></path><path d="M10 6H8a2 2 0 0 1-2-2V2h2v2h2V2h2v2a2 2 0 0 1-2 2z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->架构设计<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="DevOpts"><span class="xicon-container left title"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 20 20" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><g fill="none"><path d="M8 9a3 3 0 1 1 6 0a3 3 0 0 1-6 0zm3-2a2 2 0 1 0 0 4a2 2 0 0 0 0-4zM9 1.5a.5.5 0 0 0-1 0V3h-.5A2.5 2.5 0 0 0 5 5.5V6H3.5a.5.5 0 0 0 0 1H5v1.5H3.5a.5.5 0 0 0-.441.736A4.495 4.495 0 0 1 4.5 9c.526 0 1.03.09 1.5.256V5.5A1.5 1.5 0 0 1 7.5 4h7A1.5 1.5 0 0 1 16 5.5v7a1.5 1.5 0 0 1-1.5 1.5H8.973a4.474 4.474 0 0 1-.23 1H10.5v1.5a.5.5 0 0 0 1 0V15H13v1.5a.5.5 0 0 0 1 0V15h.5a2.5 2.5 0 0 0 2.5-2.5V12h1.5a.5.5 0 0 0 0-1H17V9.5h1.5a.5.5 0 0 0 0-1H17V7h1.5a.5.5 0 0 0 0-1H17v-.5A2.5 2.5 0 0 0 14.5 3H14V1.5a.5.5 0 0 0-1 0V3h-1.5V1.5a.5.5 0 0 0-1 0V3H9V1.5zM4.5 17c.786 0 1.512-.26 2.096-.697l2.55 2.55a.5.5 0 0 0 .708-.707l-2.55-2.55A3.5 3.5 0 1 0 4.5 17zm0-1a2.5 2.5 0 1 1 0-5a2.5 2.5 0 0 1 0 5z" fill="currentColor"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->DevOpts<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="DevOpts"><span class="title"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 20 20" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><g fill="none"><path d="M8 9a3 3 0 1 1 6 0a3 3 0 0 1-6 0zm3-2a2 2 0 1 0 0 4a2 2 0 0 0 0-4zM9 1.5a.5.5 0 0 0-1 0V3h-.5A2.5 2.5 0 0 0 5 5.5V6H3.5a.5.5 0 0 0 0 1H5v1.5H3.5a.5.5 0 0 0-.441.736A4.495 4.495 0 0 1 4.5 9c.526 0 1.03.09 1.5.256V5.5A1.5 1.5 0 0 1 7.5 4h7A1.5 1.5 0 0 1 16 5.5v7a1.5 1.5 0 0 1-1.5 1.5H8.973a4.474 4.474 0 0 1-.23 1H10.5v1.5a.5.5 0 0 0 1 0V15H13v1.5a.5.5 0 0 0 1 0V15h.5a2.5 2.5 0 0 0 2.5-2.5V12h1.5a.5.5 0 0 0 0-1H17V9.5h1.5a.5.5 0 0 0 0-1H17V7h1.5a.5.5 0 0 0 0-1H17v-.5A2.5 2.5 0 0 0 14.5 3H14V1.5a.5.5 0 0 0-1 0V3h-1.5V1.5a.5.5 0 0 0-1 0V3H9V1.5zM4.5 17c.786 0 1.512-.26 2.096-.697l2.55 2.55a.5.5 0 0 0 .708-.707l-2.55-2.55A3.5 3.5 0 1 0 4.5 17zm0-1a2.5 2.5 0 1 1 0-5a2.5 2.5 0 0 1 0 5z" fill="currentColor"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->DevOpts<!--]--></span></span></span><span class="right arrow"></span></button><ul class="dropdown-link__container" style="display:none;"><!--[--><li class="dropdown-link__item"><a href="/series/container/" class="link" aria-label="docker与kubernetes"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12.54c-1.804-.345-2.701-1.08-3.523-2.94c-.487.696-1.102 1.568-.92 2.4c.028.238-.32 1.002-.557 1H3c0 5.208 3.164 7 6.196 7c4.124.022 7.828-1.376 9.854-5c1.146-.101 2.296-1.505 2.95-2.46z"></path><path d="M5 10h3v3H5z"></path><path d="M8 10h3v3H8z"></path><path d="M11 10h3v3h-3z"></path><path d="M8 7h3v3H8z"></path><path d="M11 7h3v3h-3z"></path><path d="M11 4h3v3h-3z"></path><path d="M4.571 18c1.5 0 2.047-.074 2.958-.78"></path><path d="M10 16v.01"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->docker与kubernetes<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/devopts/" class="link" aria-label="CI/CD"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 10H2V2h8zM4 8h4V4H4z" fill="currentColor"></path><path d="M30 30h-8v-8h8zm-6-2h4v-4h-4z" fill="currentColor"></path><path d="M20 27H8a6 6 0 0 1 0-12v2a4 4 0 0 0 0 8h12z" fill="currentColor"></path><path d="M24 17v-2a4 4 0 0 0 0-8H12V5h12a6 6 0 0 1 0 12z" fill="currentColor"></path><path d="M19 11h-6l-3 4l6 6l6-6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->CI/CD<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/os/" class="link" aria-label="操作系统"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 448 512" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M220.8 123.3c1 .5 1.8 1.7 3 1.7c1.1 0 2.8-.4 2.9-1.5c.2-1.4-1.9-2.3-3.2-2.9c-1.7-.7-3.9-1-5.5-.1c-.4.2-.8.7-.6 1.1c.3 1.3 2.3 1.1 3.4 1.7zm-21.9 1.7c1.2 0 2-1.2 3-1.7c1.1-.6 3.1-.4 3.5-1.6c.2-.4-.2-.9-.6-1.1c-1.6-.9-3.8-.6-5.5.1c-1.3.6-3.4 1.5-3.2 2.9c.1 1 1.8 1.5 2.8 1.4zM420 403.8c-3.6-4-5.3-11.6-7.2-19.7c-1.8-8.1-3.9-16.8-10.5-22.4c-1.3-1.1-2.6-2.1-4-2.9c-1.3-.8-2.7-1.5-4.1-2c9.2-27.3 5.6-54.5-3.7-79.1c-11.4-30.1-31.3-56.4-46.5-74.4c-17.1-21.5-33.7-41.9-33.4-72C311.1 85.4 315.7.1 234.8 0C132.4-.2 158 103.4 156.9 135.2c-1.7 23.4-6.4 41.8-22.5 64.7c-18.9 22.5-45.5 58.8-58.1 96.7c-6 17.9-8.8 36.1-6.2 53.3c-6.5 5.8-11.4 14.7-16.6 20.2c-4.2 4.3-10.3 5.9-17 8.3s-14 6-18.5 14.5c-2.1 3.9-2.8 8.1-2.8 12.4c0 3.9.6 7.9 1.2 11.8c1.2 8.1 2.5 15.7.8 20.8c-5.2 14.4-5.9 24.4-2.2 31.7c3.8 7.3 11.4 10.5 20.1 12.3c17.3 3.6 40.8 2.7 59.3 12.5c19.8 10.4 39.9 14.1 55.9 10.4c11.6-2.6 21.1-9.6 25.9-20.2c12.5-.1 26.3-5.4 48.3-6.6c14.9-1.2 33.6 5.3 55.1 4.1c.6 2.3 1.4 4.6 2.5 6.7v.1c8.3 16.7 23.8 24.3 40.3 23c16.6-1.3 34.1-11 48.3-27.9c13.6-16.4 36-23.2 50.9-32.2c7.4-4.5 13.4-10.1 13.9-18.3c.4-8.2-4.4-17.3-15.5-29.7zM223.7 87.3c9.8-22.2 34.2-21.8 44-.4c6.5 14.2 3.6 30.9-4.3 40.4c-1.6-.8-5.9-2.6-12.6-4.9c1.1-1.2 3.1-2.7 3.9-4.6c4.8-11.8-.2-27-9.1-27.3c-7.3-.5-13.9 10.8-11.8 23c-4.1-2-9.4-3.5-13-4.4c-1-6.9-.3-14.6 2.9-21.8zM183 75.8c10.1 0 20.8 14.2 19.1 33.5c-3.5 1-7.1 2.5-10.2 4.6c1.2-8.9-3.3-20.1-9.6-19.6c-8.4.7-9.8 21.2-1.8 28.1c1 .8 1.9-.2-5.9 5.5c-15.6-14.6-10.5-52.1 8.4-52.1zm-13.6 60.7c6.2-4.6 13.6-10 14.1-10.5c4.7-4.4 13.5-14.2 27.9-14.2c7.1 0 15.6 2.3 25.9 8.9c6.3 4.1 11.3 4.4 22.6 9.3c8.4 3.5 13.7 9.7 10.5 18.2c-2.6 7.1-11 14.4-22.7 18.1c-11.1 3.6-19.8 16-38.2 14.9c-3.9-.2-7-1-9.6-2.1c-8-3.5-12.2-10.4-20-15c-8.6-4.8-13.2-10.4-14.7-15.3c-1.4-4.9 0-9 4.2-12.3zm3.3 334c-2.7 35.1-43.9 34.4-75.3 18c-29.9-15.8-68.6-6.5-76.5-21.9c-2.4-4.7-2.4-12.7 2.6-26.4v-.2c2.4-7.6.6-16-.6-23.9c-1.2-7.8-1.8-15 .9-20c3.5-6.7 8.5-9.1 14.8-11.3c10.3-3.7 11.8-3.4 19.6-9.9c5.5-5.7 9.5-12.9 14.3-18c5.1-5.5 10-8.1 17.7-6.9c8.1 1.2 15.1 6.8 21.9 16l19.6 35.6c9.5 19.9 43.1 48.4 41 68.9zm-1.4-25.9c-4.1-6.6-9.6-13.6-14.4-19.6c7.1 0 14.2-2.2 16.7-8.9c2.3-6.2 0-14.9-7.4-24.9c-13.5-18.2-38.3-32.5-38.3-32.5c-13.5-8.4-21.1-18.7-24.6-29.9s-3-23.3-.3-35.2c5.2-22.9 18.6-45.2 27.2-59.2c2.3-1.7.8 3.2-8.7 20.8c-8.5 16.1-24.4 53.3-2.6 82.4c.6-20.7 5.5-41.8 13.8-61.5c12-27.4 37.3-74.9 39.3-112.7c1.1.8 4.6 3.2 6.2 4.1c4.6 2.7 8.1 6.7 12.6 10.3c12.4 10 28.5 9.2 42.4 1.2c6.2-3.5 11.2-7.5 15.9-9c9.9-3.1 17.8-8.6 22.3-15c7.7 30.4 25.7 74.3 37.2 95.7c6.1 11.4 18.3 35.5 23.6 64.6c3.3-.1 7 .4 10.9 1.4c13.8-35.7-11.7-74.2-23.3-84.9c-4.7-4.6-4.9-6.6-2.6-6.5c12.6 11.2 29.2 33.7 35.2 59c2.8 11.6 3.3 23.7.4 35.7c16.4 6.8 35.9 17.9 30.7 34.8c-2.2-.1-3.2 0-4.2 0c3.2-10.1-3.9-17.6-22.8-26.1c-19.6-8.6-36-8.6-38.3 12.5c-12.1 4.2-18.3 14.7-21.4 27.3c-2.8 11.2-3.6 24.7-4.4 39.9c-.5 7.7-3.6 18-6.8 29c-32.1 22.9-76.7 32.9-114.3 7.2zm257.4-11.5c-.9 16.8-41.2 19.9-63.2 46.5c-13.2 15.7-29.4 24.4-43.6 25.5s-26.5-4.8-33.7-19.3c-4.7-11.1-2.4-23.1 1.1-36.3c3.7-14.2 9.2-28.8 9.9-40.6c.8-15.2 1.7-28.5 4.2-38.7c2.6-10.3 6.6-17.2 13.7-21.1c.3-.2.7-.3 1-.5c.8 13.2 7.3 26.6 18.8 29.5c12.6 3.3 30.7-7.5 38.4-16.3c9-.3 15.7-.9 22.6 5.1c9.9 8.5 7.1 30.3 17.1 41.6c10.6 11.6 14 19.5 13.7 24.6zM173.3 148.7c2 1.9 4.7 4.5 8 7.1c6.6 5.2 15.8 10.6 27.3 10.6c11.6 0 22.5-5.9 31.8-10.8c4.9-2.6 10.9-7 14.8-10.4s5.9-6.3 3.1-6.6s-2.6 2.6-6 5.1c-4.4 3.2-9.7 7.4-13.9 9.8c-7.4 4.2-19.5 10.2-29.9 10.2s-18.7-4.8-24.9-9.7c-3.1-2.5-5.7-5-7.7-6.9c-1.5-1.4-1.9-4.6-4.3-4.9c-1.4-.1-1.8 3.7 1.7 6.5z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->操作系统<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/download/" class="link" aria-label="软件下载"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"></path><path d="M7 11l5 5l5-5"></path><path d="M12 4v12"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->软件下载<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="其他"><span class="xicon-container left title"><!--[--><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="800.000000" height="800.000000" viewbox="100 100 500.000000 500.000000" preserveaspectratio="xMidYMid meet" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><metadata><!----></metadata><g transform="translate(0.000000,800.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"><path d="M3880 6044 c-180 -26 -288 -57 -400 -115 -84 -44 -217 -140 -302 -220 l-57 -54 -18 -230 c-25 -323 -23 -634 5 -785 65 -350 232 -677 449 -880 219 -204 463 -253 697 -139 273 133 537 530 624 940 37 173 45 279 39 518 -6 228 -32 564 -45 586 -4 7 -45 45 -91 85 -142 122 -304 215 -441 254 -125 36 -352 55 -460 40z m400 -196 c143 -42 268 -115 394 -230 l50 -45 12 -159 c28 -373 28 -354 7 -354 -28 0 -143 58 -188 95 -63 51 -122 135 -150 211 -14 38 -25 70 -25 70 0 1 -13 7 -30 14 -45 19 -75 5 -118 -53 -68 -91 -158 -162 -257 -200 -99 -38 -160 -48 -334 -54 -198 -6 -211 -11 -211 -82 0 -31 6 -44 28 -61 26 -22 33 -22 207 -17 209 7 305 26 430 87 44 21 106 62 138 90 32 29 59 51 61 49 1 -2 17 -24 34 -50 42 -63 147 -158 212 -194 30 -16 91 -41 135 -56 l80 -27 -3 -64 c-5 -97 -48 -296 -87 -403 -76 -212 -179 -379 -316 -516 -95 -95 -185 -148 -285 -169 -320 -67 -713 419 -799 987 -24 159 -20 465 11 795 l7 68 66 57 c139 119 273 189 429 223 129 29 382 23 502 -12z"></path><path d="M3035 3471 c-132 -38 -278 -80 -325 -94 -228 -70 -391 -240 -435 -452 -36 -177 -115 -781 -115 -882 l0 -63 74 0 c88 0 80 -11 96 149 18 189 90 695 111 781 16 68 56 135 114 189 87 83 141 104 535 216 l164 46 81 -83 c44 -46 136 -141 205 -213 412 -428 439 -455 463 -455 16 0 48 26 108 88 94 97 493 514 580 606 l56 59 254 -72 c140 -40 286 -87 324 -105 99 -47 167 -111 209 -199 32 -65 39 -98 75 -347 34 -227 81 -608 81 -650 0 -6 31 -10 81 -10 l80 0 -5 70 c-3 39 -9 103 -12 143 -14 185 -101 749 -126 816 -55 148 -188 282 -341 342 -70 28 -633 189 -660 189 -23 0 -23 0 -357 -351 -317 -333 -343 -359 -350 -359 -3 0 -78 75 -165 168 -87 92 -208 219 -269 282 -61 64 -142 148 -180 188 -44 47 -76 72 -90 71 -11 0 -129 -31 -261 -68z"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->其他<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="其他"><span class="title"><span class="xicon-container left"><!--[--><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="800.000000" height="800.000000" viewbox="100 100 500.000000 500.000000" preserveaspectratio="xMidYMid meet" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><metadata><!----></metadata><g transform="translate(0.000000,800.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"><path d="M3880 6044 c-180 -26 -288 -57 -400 -115 -84 -44 -217 -140 -302 -220 l-57 -54 -18 -230 c-25 -323 -23 -634 5 -785 65 -350 232 -677 449 -880 219 -204 463 -253 697 -139 273 133 537 530 624 940 37 173 45 279 39 518 -6 228 -32 564 -45 586 -4 7 -45 45 -91 85 -142 122 -304 215 -441 254 -125 36 -352 55 -460 40z m400 -196 c143 -42 268 -115 394 -230 l50 -45 12 -159 c28 -373 28 -354 7 -354 -28 0 -143 58 -188 95 -63 51 -122 135 -150 211 -14 38 -25 70 -25 70 0 1 -13 7 -30 14 -45 19 -75 5 -118 -53 -68 -91 -158 -162 -257 -200 -99 -38 -160 -48 -334 -54 -198 -6 -211 -11 -211 -82 0 -31 6 -44 28 -61 26 -22 33 -22 207 -17 209 7 305 26 430 87 44 21 106 62 138 90 32 29 59 51 61 49 1 -2 17 -24 34 -50 42 -63 147 -158 212 -194 30 -16 91 -41 135 -56 l80 -27 -3 -64 c-5 -97 -48 -296 -87 -403 -76 -212 -179 -379 -316 -516 -95 -95 -185 -148 -285 -169 -320 -67 -713 419 -799 987 -24 159 -20 465 11 795 l7 68 66 57 c139 119 273 189 429 223 129 29 382 23 502 -12z"></path><path d="M3035 3471 c-132 -38 -278 -80 -325 -94 -228 -70 -391 -240 -435 -452 -36 -177 -115 -781 -115 -882 l0 -63 74 0 c88 0 80 -11 96 149 18 189 90 695 111 781 16 68 56 135 114 189 87 83 141 104 535 216 l164 46 81 -83 c44 -46 136 -141 205 -213 412 -428 439 -455 463 -455 16 0 48 26 108 88 94 97 493 514 580 606 l56 59 254 -72 c140 -40 286 -87 324 -105 99 -47 167 -111 209 -199 32 -65 39 -98 75 -347 34 -227 81 -608 81 -650 0 -6 31 -10 81 -10 l80 0 -5 70 c-3 39 -9 103 -12 143 -14 185 -101 749 -126 816 -55 148 -188 282 -341 342 -70 28 -633 189 -660 189 -23 0 -23 0 -357 -351 -317 -333 -343 -359 -350 -359 -3 0 -78 75 -165 168 -87 92 -208 219 -269 282 -61 64 -142 148 -180 188 -44 47 -76 72 -90 71 -11 0 -129 -31 -261 -68z"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->其他<!--]--></span></span></span><span class="right arrow"></span></button><ul class="dropdown-link__container" style="display:none;"><!--[--><li class="dropdown-link__item"><a href="/series/drone/" class="link" aria-label="无人机"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="800.000000" height="800.000000" viewbox="100 100 500.000000 500.000000" preserveaspectratio="xMidYMid meet" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><metadata><!----></metadata><g transform="translate(0.000000,800.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"><path d="M2405 6020 c-190 -50 -318 -129 -436 -271 -175 -208 -219 -504 -111 -741 103 -227 281 -376 539 -450 104 -30 315 -32 411 -4 34 10 62 20 62 23 0 2 -16 25 -36 52 l-36 48 -51 -14 c-74 -21 -251 -12 -342 17 -122 38 -202 87 -296 180 -60 60 -96 106 -122 156 -182 353 19 771 425 884 91 25 261 27 352 4 33 -8 104 -36 156 -62 78 -38 110 -61 181 -132 148 -147 207 -302 196 -516 l-6 -111 40 -33 c25 -20 44 -29 50 -23 17 17 39 147 39 234 0 112 -27 219 -86 337 -102 203 -306 362 -541 423 -102 26 -289 26 -388 -1z"></path><path d="M4975 5984 c-160 -36 -316 -125 -431 -246 -83 -89 -135 -175 -171 -283 -34 -104 -39 -295 -10 -388 l18 -58 47 34 c41 29 46 37 42 63 -3 16 -5 83 -4 149 0 132 15 185 85 301 131 218 430 359 687 324 188 -25 318 -93 444 -228 68 -74 123 -180 144 -282 83 -392 -291 -774 -730 -747 -50 3 -98 8 -107 12 -20 8 -97 -81 -83 -95 5 -5 47 -16 94 -26 102 -20 237 -15 350 15 268 69 490 272 576 526 23 68 27 97 28 195 1 138 -11 195 -71 319 -38 80 -59 108 -137 186 -107 108 -196 164 -328 207 -82 27 -109 31 -233 34 -101 3 -160 -1 -210 -12z"></path><path d="M2561 5418 c-53 -27 -79 -60 -87 -110 -14 -86 -9 -94 234 -342 350 -356 468 -501 550 -673 75 -160 51 -311 -81 -508 -79 -118 -165 -214 -433 -486 -292 -295 -305 -313 -290 -393 14 -72 94 -136 172 -136 59 0 97 26 262 179 427 396 666 559 896 608 90 19 176 12 286 -22 238 -76 464 -237 840 -601 157 -152 188 -170 266 -161 110 12 177 133 128 230 -9 18 -127 145 -263 282 -327 331 -416 438 -496 594 -87 173 -91 273 -15 427 76 156 258 371 590 699 89 88 169 173 178 190 20 39 20 112 -1 152 -40 75 -146 105 -229 64 -24 -12 -104 -78 -178 -147 -296 -276 -512 -442 -685 -529 -132 -65 -213 -88 -320 -88 -183 0 -364 85 -620 290 -100 80 -148 123 -389 345 -70 65 -140 125 -156 133 -54 28 -110 29 -159 3z m269 -259 c497 -457 712 -596 980 -630 145 -19 301 17 470 108 197 106 356 232 748 591 56 50 110 92 121 92 19 0 51 -34 51 -55 0 -6 -93 -105 -207 -221 -263 -265 -362 -375 -452 -494 -232 -310 -242 -521 -37 -838 74 -114 218 -277 462 -523 140 -142 234 -245 234 -256 0 -26 -19 -43 -48 -43 -18 0 -66 41 -180 151 -422 411 -719 599 -1015 640 -73 10 -99 9 -179 -5 -266 -49 -543 -235 -1027 -688 -103 -97 -124 -108 -162 -88 -43 23 -23 49 239 314 347 351 451 479 537 661 118 252 56 473 -226 810 -46 55 -189 206 -316 336 -142 144 -233 244 -233 256 0 25 19 43 45 43 13 0 86 -60 195 -161z"></path><path d="M3789 4437 c-107 -31 -213 -125 -246 -220 -71 -210 78 -429 308 -453 236 -24 439 208 376 427 -33 110 -105 189 -215 232 -61 24 -165 30 -223 14z m162 -119 c101 -34 164 -116 163 -213 0 -89 -45 -159 -131 -201 -51 -25 -154 -25 -203 0 -102 53 -156 159 -130 257 14 53 97 139 150 156 47 15 110 15 151 1z"></path><path d="M2425 3676 c-160 -43 -267 -101 -382 -209 -167 -156 -256 -399 -224 -608 41 -266 204 -484 444 -594 125 -57 194 -70 362 -70 129 0 160 3 225 23 275 87 473 274 557 527 23 69 27 97 27 205 1 94 -4 140 -18 188 -10 34 -22 62 -25 62 -4 0 -26 -14 -50 -32 l-43 -31 8 -51 c5 -28 9 -94 8 -146 -4 -315 -256 -576 -609 -630 -230 -35 -495 73 -636 258 -66 87 -106 170 -125 262 -69 323 167 653 524 734 76 17 243 21 304 7 36 -8 39 -7 73 34 19 24 35 48 35 53 0 19 -93 34 -230 38 -119 4 -145 1 -225 -20z"></path><path d="M5035 3695 c-5 -2 -35 -9 -65 -15 -84 -16 -87 -20 -48 -74 l33 -47 50 8 c27 4 100 8 160 7 96 0 121 -5 198 -31 116 -41 185 -83 278 -171 89 -84 150 -191 174 -307 19 -89 19 -134 0 -229 -70 -370 -475 -608 -858 -505 -217 58 -398 218 -473 415 -45 121 -49 204 -18 375 6 35 4 38 -40 68 l-45 32 -17 -38 c-9 -21 -23 -76 -31 -123 -43 -236 64 -507 267 -677 72 -60 232 -143 325 -168 89 -24 293 -30 381 -12 286 61 516 259 602 520 91 273 19 547 -196 749 -158 148 -364 229 -580 227 -48 0 -91 -2 -97 -4z"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->无人机<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/entertainment/" class="link" aria-label="电影&amp;电视剧&amp;综艺"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="800.000000" height="800.000000" viewbox="100 100 500.000000 500.000000" preserveaspectratio="xMidYMid meet" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><metadata><!----></metadata><g transform="translate(0.000000,800.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"><path d="M3675 5533 c-49 -7 -127 -34 -174 -60 -97 -56 -164 -137 -208 -250 -35 -92 -36 -228 -3 -318 24 -65 100 -179 125 -188 8 -4 15 -11 15 -17 0 -7 -102 -10 -305 -10 -168 0 -305 3 -305 6 0 4 15 24 34 45 38 42 76 146 76 209 0 73 -37 165 -89 222 -74 81 -137 111 -241 116 -69 3 -96 0 -142 -18 -79 -29 -147 -94 -188 -176 -29 -59 -33 -78 -33 -148 -1 -68 4 -91 27 -141 15 -33 39 -72 53 -87 l27 -28 -158 0 c-90 0 -175 -5 -197 -11 -52 -16 -103 -61 -128 -112 -21 -43 -21 -55 -21 -658 0 -577 2 -616 19 -655 22 -48 52 -78 103 -105 36 -18 77 -19 1398 -19 1207 0 1365 2 1398 16 49 20 90 60 113 109 17 38 19 78 19 653 0 669 1 652 -58 716 -60 64 -71 66 -451 66 l-344 0 46 49 c53 56 99 143 117 220 17 72 8 201 -20 273 -75 201 -292 329 -505 301z m213 -147 c160 -82 242 -254 197 -412 -73 -260 -387 -355 -585 -177 -204 183 -138 507 123 604 76 29 194 22 265 -15z m-1201 -237 c139 -72 166 -261 51 -364 -52 -48 -95 -65 -160 -65 -172 0 -281 190 -197 340 23 41 83 89 134 108 44 17 118 8 172 -19z m2039 -590 c49 -26 49 -22 49 -655 l0 -594 -33 -32 -32 -33 -1330 -3 c-1154 -2 -1335 0 -1365 13 -66 27 -65 19 -65 647 0 349 4 577 10 599 11 41 42 66 86 71 16 2 621 2 1344 1 951 -2 1321 -6 1336 -14z"></path><path d="M5419 4784 c-195 -141 -362 -264 -372 -273 -14 -14 -17 -30 -15 -84 l3 -66 360 259 c197 143 360 260 362 260 2 0 3 -437 3 -971 0 -790 -2 -970 -13 -966 -7 3 -152 97 -322 209 -171 113 -329 217 -352 231 l-43 27 0 -68 0 -69 273 -180 c415 -275 460 -303 485 -310 31 -7 73 24 84 63 4 16 7 508 5 1093 l-3 1063 -23 19 c-48 39 -60 32 -432 -237z"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->电影&amp;电视剧&amp;综艺<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/language/" class="link" aria-label="语言学习"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="800.000000" height="800.000000" viewbox="100 100 500.000000 500.000000" preserveaspectratio="xMidYMid meet" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><metadata><!----></metadata><g transform="translate(0.000000,800.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"><path d="M2412 5986 c-166 -62 -281 -198 -318 -376 -13 -62 -14 -287 -12 -1648 l3 -1577 23 -59 c61 -162 174 -277 315 -321 29 -9 60 -20 69 -26 23 -12 2545 -12 2552 0 3 5 21 12 39 15 50 9 110 59 142 118 27 48 30 63 33 171 l4 117 -86 0 -86 0 0 -100 c0 -94 -2 -103 -25 -125 l-24 -25 -1259 0 c-1421 0 -1320 -6 -1413 78 -92 82 -135 195 -109 287 17 60 81 132 145 161 48 23 60 24 268 24 l217 0 0 1300 0 1300 -225 0 c-254 -1 -277 4 -347 75 -99 100 -82 278 38 384 60 53 105 72 188 82 39 4 608 8 1264 9 1250 0 1241 0 1268 -41 5 -8 11 -201 14 -429 l5 -415 80 0 80 0 0 430 0 430 -25 48 c-13 27 -41 62 -61 78 -80 63 15 59 -1401 58 l-1293 0 -63 -23z m-117 -802 c49 -36 142 -54 291 -54 l144 0 0 -1129 0 -1129 -152 -4 c-161 -5 -231 -21 -291 -68 -14 -11 -28 -20 -31 -20 -3 0 -6 545 -6 1210 0 962 3 1210 13 1210 6 0 21 -7 32 -16z"></path><path d="M4720 4635 c-216 -37 -436 -156 -584 -316 -175 -189 -270 -438 -268 -704 1 -247 72 -452 222 -638 149 -186 371 -319 605 -362 123 -23 347 -17 460 14 94 25 239 92 326 152 235 159 394 432 429 737 33 278 -69 586 -263 798 -231 252 -592 376 -927 319z m209 -179 c38 -20 74 -71 122 -169 48 -101 107 -326 88 -337 -44 -28 -317 -38 -439 -16 l-65 11 3 40 c10 132 101 359 177 441 44 47 68 53 114 30z m-342 -83 c-36 -71 -84 -210 -102 -299 -9 -43 -17 -79 -18 -81 -1 -1 -32 11 -67 26 -84 36 -195 103 -195 119 0 18 111 129 180 180 69 51 218 127 223 113 2 -5 -8 -31 -21 -58z m658 33 c119 -55 211 -125 298 -225 l39 -44 -24 -19 c-36 -28 -217 -118 -239 -118 -13 0 -19 7 -19 23 0 63 -76 300 -120 374 -32 54 -32 54 65 9z m-1048 -465 c40 -24 112 -60 159 -81 l87 -37 -1 -189 -1 -188 -48 -17 c-52 -17 -182 -82 -250 -124 -51 -31 -50 -31 -84 95 -33 124 -33 333 -1 443 28 97 49 150 59 145 5 -1 41 -23 80 -47z m1501 -22 c54 -148 67 -319 36 -466 -15 -75 -40 -150 -55 -167 -4 -4 -27 5 -51 22 -55 38 -179 100 -241 121 l-48 17 -3 190 -3 190 81 33 c45 18 117 54 161 81 44 26 85 47 90 46 6 -1 20 -31 33 -67z m-813 -154 c99 0 203 4 231 8 l52 9 7 -87 c4 -47 4 -113 0 -146 l-7 -61 -37 6 c-89 15 -335 18 -422 6 -50 -6 -93 -10 -95 -7 -10 9 -16 175 -10 231 l8 57 46 -8 c26 -4 128 -8 227 -8z m166 -426 c46 -6 88 -15 92 -19 20 -18 -46 -256 -100 -365 -76 -150 -122 -191 -185 -161 -79 38 -186 273 -222 488 l-7 36 53 11 c109 22 251 25 369 10z m-571 -127 c18 -91 59 -219 100 -314 25 -59 34 -88 25 -88 -7 0 -57 22 -112 49 -106 54 -194 123 -268 214 -46 55 -47 58 -29 73 31 24 256 134 265 129 4 -3 13 -31 19 -63z m970 7 c52 -27 106 -58 120 -68 22 -18 23 -21 10 -46 -23 -43 -170 -178 -235 -215 -84 -49 -179 -91 -183 -80 -2 4 10 35 26 67 42 81 86 212 107 316 21 102 10 100 155 26z"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->语言学习<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><li class="social-item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:25px;height:25px;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></li><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><header class="sub-navbar-container not-open"><span class="nav-item"><div class="toggle-series-button" aria-expanded="false" role="button" tabindex="0"><span></span><span></span><span></span></div> Series </span></header><!----><!----><div class="theme-main" style=""><aside class="series-container"><!--[--><!--[--><a href="/series/distribution/" class="link series-item series-item" aria-label="分布式"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分布式<!--]--></span></span><!--[--><!--]--></a><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->Redis<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/series/distribution/Redis/01Redisdeanzhuangbushu.html" class="link series-item series-item" aria-label="1、Redis的安装部署"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1、Redis的安装部署<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/series/distribution/Redis/02Redischangyongshujuleixingyijishiyongchangjing.html" class="link series-item series-item" aria-label="2、Redis常用数据类型以及使用场景"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2、Redis常用数据类型以及使用场景<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1 active"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->分布式事务<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/series/distribution/fenbushishiwu/01fenbushishiwudebeijinghejiejuefangan.html" class="link series-item series-item" aria-label="1、分布式事务的背景和解决方案"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1、分布式事务的背景和解决方案<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/series/distribution/fenbushishiwu/02fenbushishiwuSeatadeyingyongyuyuanlifenxi.html" class="link series-item series-item" aria-label="2、分布式事务Seata的应用与原理分析"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2、分布式事务Seata的应用与原理分析<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/series/distribution/fenbushishiwu/03fenbushishiwujiejuefanganSeatachutiyan.html" class="link series-item series-item" aria-label="3、分布式事务解决方案Seata初体验"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3、分布式事务解决方案Seata初体验<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/series/distribution/fenbushishiwu/04fenbushishiwuSeatadegaojiyingyongxiangjie.html" class="link series-item series-item" aria-label="4、分布式事务Seata的高级应用详解"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4、分布式事务Seata的高级应用详解<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a aria-current="page" href="/series/distribution/fenbushishiwu/05fenbushishiwuSeatayuanmaxuexi.html" class="router-link-active router-link-exact-active link router-link-active series-item series-item" aria-label="5、分布式事务Seata源码学习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->5、分布式事务Seata源码学习<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--]--></aside><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">5、分布式事务Seata源码学习</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Navy<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2026-01-07<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/categories/fenbushi/1.html" class="">分布式</a><a href="/categories/shiwu/1.html" class="">事务</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/tags/fenbushi/1.html" class="">分布式</a><a href="/tags/shiwu/1.html" class="">事务</a><a href="/tags/seata/1.html" class="">seata</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;font-size:18px;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 12 12"><g fill="none"><path d="M1.974 6.659a.5.5 0 0 1-.948-.317c-.01.03 0-.001 0-.001a1.633 1.633 0 0 1 .062-.162c.04-.095.099-.226.18-.381c.165-.31.422-.723.801-1.136C2.834 3.827 4.087 3 6 3c1.913 0 3.166.827 3.931 1.662a5.479 5.479 0 0 1 .98 1.517l.046.113c.003.008.013.06.023.11L11 6.5s.084.333-.342.474a.5.5 0 0 1-.632-.314v-.003l-.006-.016a3.678 3.678 0 0 0-.172-.376a4.477 4.477 0 0 0-.654-.927C8.584 4.673 7.587 4 6 4s-2.584.673-3.194 1.338a4.477 4.477 0 0 0-.795 1.225a2.209 2.209 0 0 0-.03.078l-.007.018zM6 5a2 2 0 1 0 0 4a2 2 0 0 0 0-4zM5 7a1 1 0 1 1 2 0a1 1 0 0 1-2 0z" fill="currentColor"></path></g></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><span id="/series/distribution/fenbushishiwu/05fenbushishiwuSeatayuanmaxuexi.html" class="leancloud-visitors" data-flag-title="Your Article Title"><a class="leancloud-visitors-count" style=""></a></span><!----><!--]--></span></span></div><div class="theme-reco-md-content"><div><blockquote><p>本文结合seata的AT模型来对seata的源码实现进行学习</p></blockquote><h2 id="_1、seata的at模型回顾" tabindex="-1"><a class="header-anchor" href="#_1、seata的at模型回顾"><span>1、Seata的AT模型回顾</span></a></h2><h3 id="_1-1、seata的at模型" tabindex="-1"><a class="header-anchor" href="#_1-1、seata的at模型"><span>1.1、Seata的AT模型</span></a></h3><p><img src="http://blog.shengxiao.tech/images/image-20260107112546305.png" alt="image-20260107112546305"></p><p><img src="http://blog.shengxiao.tech/images/image-20260107115406677.png" alt="image-20260107115406677"></p><ul><li>在服务A中开启全局事务，向TC申请全局事务id</li><li>服务A发起RPC远程调用，分布式事务参与方服务B和服务C分别向TC注册分支事务</li><li>参与方提交本地事务，并记录undo_log表</li><li>参与方上报分支事务的执行状态</li><li>TC根据各分支事务执行状态，通知全局事务是要提交还是回滚</li><li>分布式事务各参与方TC指示，如果是要提交全局事务，就直接删除本地表的undo_log表里边对应的记录即可，如果是需要回滚，则根据undo_log表里边的before_image对对应的数据进行回滚</li></ul><h3 id="_1-2、seata的at模型在实际开发中的应用" tabindex="-1"><a class="header-anchor" href="#_1-2、seata的at模型在实际开发中的应用"><span>1.2、Seata的AT模型在实际开发中的应用</span></a></h3><p>要在应用中使用Seata的AT模型也非常简单，只需要简单几步：</p><ul><li>① 引入seata依赖</li><li>② 创建本地undo_log表</li><li>③ 在配置文件中进行Seata相关的配置</li><li>④ <code>@GlobalTransactional</code>注解开启分布式事务</li></ul><blockquote><p>具体操作见前面的博客内容</p></blockquote><h2 id="_2、核心步骤源码分析-at" tabindex="-1"><a class="header-anchor" href="#_2、核心步骤源码分析-at"><span>2、核心步骤源码分析（AT）</span></a></h2><h3 id="_2-1、rm、tm建立与tc的连接" tabindex="-1"><a class="header-anchor" href="#_2-1、rm、tm建立与tc的连接"><span>2.1、RM、TM建立与TC的连接</span></a></h3><p>要想开启分布式事务，前提是RM、TM持有和TC的连接，这样才能完成通信。那么这个连接是在什么时候建立的呢？首先我们看一下<code>@GlobalTransactional</code>注解的包结构：</p><p><img src="http://blog.shengxiao.tech/images/image-20260107153749594.png" alt="image-20260107153749594"></p><p>可以看到这个注解定义在<code>org.apache.seata.spring.annotation</code>这个包下，与此同时还定义了一个以<code>Scanner</code>结尾的扫描器，点开看一下这个扫描器</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalTransactionScanner</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAutoProxyCreator</span></span>
<span class="line">        <span class="token keyword">implements</span> <span class="token class-name">CachedConfigurationChangeListener</span><span class="token punctuation">,</span> <span class="token class-name">InitializingBean</span><span class="token punctuation">,</span> <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">,</span> <span class="token class-name">DisposableBean</span> <span class="token punctuation">{</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这个扫描器实现了<code>InitializingBean</code>这个接口，那么就一定实现了它的<code>afterPropertiesSet</code>方法</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>disableGlobalTransaction<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Global transaction is disabled.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token class-name">ConfigurationFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addConfigListener</span><span class="token punctuation">(</span><span class="token class-name">ConfigurationKeys</span><span class="token punctuation">.</span><span class="token constant">DISABLE_GLOBAL_TRANSACTION</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">CachedConfigurationChangeListener</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialized<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//初始化客户端，什么客户端呢？</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findBusinessBeanNamesNeededEnhancement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里有一个初始化客户端的方法，那么初始化的是什么客户端呢？继续点进去就可以看到初始化TM和RM的代码</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Initializing Global Transaction Clients ... &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEFAULT_TX_GROUP_OLD</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>txServiceGroup<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;the default value of seata.tx-service-group: {} has already changed to {} since Seata 1.5, &quot;</span> <span class="token operator">+</span></span>
<span class="line">                    <span class="token string">&quot;please change your default configuration as soon as possible &quot;</span> <span class="token operator">+</span></span>
<span class="line">                    <span class="token string">&quot;and we don&#39;t recommend you to use default tx-service-group&#39;s value provided by seata&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token constant">DEFAULT_TX_GROUP_OLD</span><span class="token punctuation">,</span> <span class="token constant">DEFAULT_TX_GROUP</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>applicationId<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span>txServiceGroup<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;applicationId: %s, txServiceGroup: %s&quot;</span><span class="token punctuation">,</span> applicationId<span class="token punctuation">,</span> txServiceGroup<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//init TM</span></span>
<span class="line">    <span class="token class-name">TMClient</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>applicationId<span class="token punctuation">,</span> txServiceGroup<span class="token punctuation">,</span> accessKey<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Transaction Manager Client is initialized. applicationId[{}] txServiceGroup[{}]&quot;</span><span class="token punctuation">,</span> applicationId<span class="token punctuation">,</span> txServiceGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">//init RM</span></span>
<span class="line">    <span class="token class-name">RMClient</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>applicationId<span class="token punctuation">,</span> txServiceGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Resource Manager is initialized. applicationId[{}] txServiceGroup[{}]&quot;</span><span class="token punctuation">,</span> applicationId<span class="token punctuation">,</span> txServiceGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Global Transaction Clients are initialized. &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">registerSpringShutdownHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以初始化RM的代码为例，继续</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RMClient</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * Init.</span>
<span class="line">     *</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">applicationId</span>           the application id</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">transactionServiceGroup</span> the transaction service group</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">String</span> applicationId<span class="token punctuation">,</span> <span class="token class-name">String</span> transactionServiceGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">RmNettyRemotingClient</span> rmNettyRemotingClient <span class="token operator">=</span> <span class="token class-name">RmNettyRemotingClient</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>applicationId<span class="token punctuation">,</span> transactionServiceGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        rmNettyRemotingClient<span class="token punctuation">.</span><span class="token function">setResourceManager</span><span class="token punctuation">(</span><span class="token class-name">DefaultResourceManager</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        rmNettyRemotingClient<span class="token punctuation">.</span><span class="token function">setTransactionMessageHandler</span><span class="token punctuation">(</span><span class="token class-name">DefaultRMHandler</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        rmNettyRemotingClient<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>继续点进init方法来到<code>org.apache.seata.core.rpc.netty.RmNettyRemotingClient#init</code></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// registry processor</span></span>
<span class="line">    <span class="token function">registerProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialized<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// Found one or more resources that were registered before initialization</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>resourceManager <span class="token operator">!=</span> <span class="token keyword">null</span></span>
<span class="line">            <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>resourceManager<span class="token punctuation">.</span><span class="token function">getManagedResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token operator">&amp;&amp;</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>transactionServiceGroup<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">boolean</span> failFast <span class="token operator">=</span> <span class="token class-name">ConfigurationFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span></span>
<span class="line">                <span class="token class-name">ConfigurationKeys</span><span class="token punctuation">.</span><span class="token constant">ENABLE_RM_CLIENT_CHANNEL_CHECK_FAIL_FAST</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token class-name">DefaultValues</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CLIENT_CHANNEL_CHECK_FAIL_FAST</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token function">getClientChannelManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initReconnect</span><span class="token punctuation">(</span>transactionServiceGroup<span class="token punctuation">,</span> failFast<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>先看一下super.init()，进入<code>org.apache.seata.core.rpc.netty.AbstractNettyRemotingClient#init</code></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    timerExecutor<span class="token punctuation">.</span><span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            clientChannelManager<span class="token punctuation">.</span><span class="token function">reconnect</span><span class="token punctuation">(</span><span class="token function">getTransactionServiceGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;reconnect server failed. {}&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">SCHEDULE_DELAY_MILLS</span><span class="token punctuation">,</span> <span class="token constant">SCHEDULE_INTERVAL_MILLS</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isEnableClientBatchSendRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        mergeSendExecutorService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token constant">MAX_MERGE_SEND_THREAD</span><span class="token punctuation">,</span></span>
<span class="line">                                                          <span class="token constant">MAX_MERGE_SEND_THREAD</span><span class="token punctuation">,</span></span>
<span class="line">                                                          <span class="token constant">KEEP_ALIVE_TIME</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">,</span></span>
<span class="line">                                                          <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                                                          <span class="token keyword">new</span> <span class="token class-name">NamedThreadFactory</span><span class="token punctuation">(</span><span class="token function">getThreadPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">MAX_MERGE_SEND_THREAD</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        mergeSendExecutorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MergedSendRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    clientBootstrap<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里调了一个<code>getTransactionServiceGroup()</code>方法，<code>transactionServiceGroup</code>我们之前就在配置文件中配置过，前面提到会根据这个serviceGroup去找到对应的SeataServer，不妨点<code>clientChannelManager.reconnect()</code> 进去看一下，看是不是根据这个serviceGroup去连接TC，点进去之后经过几个重载的方法后来到了<code>doReconnect</code>方法：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">void</span> <span class="token function">doReconnect</span><span class="token punctuation">(</span><span class="token class-name">String</span> transactionServiceGroup<span class="token punctuation">,</span> <span class="token keyword">boolean</span> failFast<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> availList<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        availList <span class="token operator">=</span> <span class="token function">getAvailServerList</span><span class="token punctuation">(</span>transactionServiceGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to get available servers: {}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">throwFailFastException</span><span class="token punctuation">(</span>failFast<span class="token punctuation">,</span> <span class="token string">&quot;Failed to get available servers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>availList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">RegistryService</span> registryService <span class="token operator">=</span> <span class="token class-name">RegistryFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> clusterName <span class="token operator">=</span> registryService<span class="token punctuation">.</span><span class="token function">getServiceGroup</span><span class="token punctuation">(</span>transactionServiceGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>clusterName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;can not get cluster name in registry config &#39;{}{}&#39;, please make sure registry config correct&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                         <span class="token class-name">ConfigurationKeys</span><span class="token punctuation">.</span><span class="token constant">SERVICE_GROUP_MAPPING_PREFIX</span><span class="token punctuation">,</span></span>
<span class="line">                         transactionServiceGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token function">throwFailFastException</span><span class="token punctuation">(</span>failFast<span class="token punctuation">,</span> <span class="token string">&quot;can not get cluster name in registry config.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>registryService <span class="token keyword">instanceof</span> <span class="token class-name">FileRegistryServiceImpl</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;no available service found in cluster &#39;{}&#39;, please make sure registry config correct and keep your seata server running&quot;</span><span class="token punctuation">,</span> clusterName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token function">throwFailFastException</span><span class="token punctuation">(</span>failFast<span class="token punctuation">,</span> <span class="token string">&quot;no available service found in cluster.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">doReconnect</span><span class="token punctuation">(</span>availList<span class="token punctuation">,</span> transactionServiceGroup<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>failFast<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> e<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;connect server failed. {}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>确实是拿到了一个可用的地址列表<code>availList</code>，然后根据这个列表继续调了<code>doReconnect</code>方法</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">void</span> <span class="token function">doReconnect</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> availList<span class="token punctuation">,</span> <span class="token class-name">String</span> transactionServiceGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> channelAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>availList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Exception</span><span class="token punctuation">&gt;</span></span> failedMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> serverAddress <span class="token operator">:</span> availList<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">acquireChannel</span><span class="token punctuation">(</span>serverAddress<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                channelAddress<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>serverAddress<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                failedMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>serverAddress<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>failedMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;{} can not connect to {} cause:{}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">FrameworkErrorCode<span class="token punctuation">.</span>NetConnect</span><span class="token punctuation">.</span><span class="token function">getErrCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                             failedMap<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                             failedMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span><span class="token operator">::</span><span class="token function">getMessage</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                failedMap<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;{} can not connect to {} cause:{} trace information:&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                                 <span class="token class-name">FrameworkErrorCode<span class="token punctuation">.</span>NetConnect</span><span class="token punctuation">.</span><span class="token function">getErrCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>availList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> failedMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">String</span> invalidAddress <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>failedMap<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FrameworkException</span><span class="token punctuation">(</span><span class="token string">&quot;can not connect to [&quot;</span> <span class="token operator">+</span> invalidAddress <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>channelAddress<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InetSocketAddress</span><span class="token punctuation">&gt;</span></span> aliveAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>channelAddress<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> address <span class="token operator">:</span> channelAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token class-name">NetUtil</span><span class="token punctuation">.</span><span class="token function">splitIPPortStr</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                aliveAddress<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token class-name">RegistryFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">refreshAliveLookup</span><span class="token punctuation">(</span>transactionServiceGroup<span class="token punctuation">,</span> aliveAddress<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">RegistryFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">refreshAliveLookup</span><span class="token punctuation">(</span>transactionServiceGroup<span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到会根据这个列表迭代，然后根据每个serverAddress通过<code>acquireChannel</code>方法获取了一个Channel（如果没有现成的连接，则会通过<code>doConnect(serverAddress)</code>方法创建一个channel）</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Channel</span> <span class="token function">acquireChannel</span><span class="token punctuation">(</span><span class="token class-name">String</span> serverAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Channel</span> channelToServer <span class="token operator">=</span> channels<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>serverAddress<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>channelToServer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        channelToServer <span class="token operator">=</span> <span class="token function">getExistAliveChannel</span><span class="token punctuation">(</span>channelToServer<span class="token punctuation">,</span> serverAddress<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>channelToServer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> channelToServer<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;will connect to {}&quot;</span><span class="token punctuation">,</span> serverAddress<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token class-name">Object</span> lockObj <span class="token operator">=</span> <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span>channelLocks<span class="token punctuation">,</span> serverAddress<span class="token punctuation">,</span> key <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lockObj<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">doConnect</span><span class="token punctuation">(</span>serverAddress<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TM的连接建立流程类似，总的来说大致的流程如下：</p><p><img src="http://blog.shengxiao.tech/images/image-20260107161331952.png" alt="image-20260107161331952"></p><h3 id="_2-2、事务处理" tabindex="-1"><a class="header-anchor" href="#_2-2、事务处理"><span>2.2、事务处理</span></a></h3><p>前面我们知道，分布式事务的开启是靠<code>@GlobalTransactional</code>这个注解开启的，那么肯定就有一个地方来识别这个注解并做一些事情。如果是我们自己来做的化，最先想到的肯定是基于aop来做，而从最上面的那个包结构截图可以看到，紧挨着<code>GlobalTransactional</code>这个注解还定义了一个<code>AspectTransactionalInterceptor</code>类</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectTransactionalInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>既然这个类实现了<code>MethodInterceptor</code>接口，那程序在执行的时候肯定会调用它的<code>invoke</code>方法</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token class-name">AopUtils</span><span class="token punctuation">.</span><span class="token function">getTargetClass</span><span class="token punctuation">(</span>invocation<span class="token punctuation">.</span><span class="token function">getThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Method</span> specificMethod <span class="token operator">=</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">getMostSpecificMethod</span><span class="token punctuation">(</span>invocation<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">InvocationWrapper</span> invocationWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultInvocationWrapper</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> invocation<span class="token punctuation">.</span><span class="token function">getThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> specificMethod<span class="token punctuation">,</span> invocation<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>globalTransactionalInterceptorHandler<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>invocationWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>继续点进去最后一行的<code>globalTransactionalInterceptorHandler.invoke</code>方法，就来到了<code>org.apache.seata.integration.tx.api.interceptor.handler.AbstractProxyInvocationHandler#invoke</code></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">InvocationWrapper</span> invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token function">getMethodsToProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">getMethodsToProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>invocation<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> invocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextInvocationHandlerChain <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        invocation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NestInterceptorHandlerWrapper</span><span class="token punctuation">(</span>nextInvocationHandlerChain<span class="token punctuation">,</span> ihttp<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>blog<span class="token punctuation">.</span>shengxiao<span class="token punctuation">.</span>tech<span class="token operator">/</span>imagesnvocation<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">doInvoke</span><span class="token punctuation">(</span>invocation<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最终来到<code>org.apache.seata.integration.tx.api.interceptor.handler.GlobalTransactionalInterceptorHandler#doInvoke</code></p><p><img src="http://blog.shengxiao.tech/images/image-20260107162047514.png" alt="image-20260107162047514"></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">doInvoke</span><span class="token punctuation">(</span><span class="token class-name">InvocationWrapper</span> invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass <span class="token operator">=</span> invocation<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Method</span> specificMethod <span class="token operator">=</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">getMostSpecificMethod</span><span class="token punctuation">(</span>invocation<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>specificMethod <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>specificMethod<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">boolean</span> localDisable <span class="token operator">=</span> disable <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token constant">ATOMIC_DEGRADE_CHECK</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> degradeNum <span class="token operator">&gt;=</span> degradeCheckAllowTimes<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>localDisable<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">final</span> <span class="token class-name">AspectTransactional</span> globalTransactionalAnnotation <span class="token operator">=</span> <span class="token function">getAspectTransactional</span><span class="token punctuation">(</span>specificMethod<span class="token punctuation">,</span> targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">final</span> <span class="token class-name">GlobalLockConfig</span> globalLockAnnotation <span class="token operator">=</span> <span class="token function">getGlobalLockConfig</span><span class="token punctuation">(</span>specificMethod<span class="token punctuation">,</span> targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>globalTransactionalAnnotation <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aspectTransactional <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">AspectTransactional</span> transactional<span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>globalTransactionalAnnotation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    transactional <span class="token operator">=</span> globalTransactionalAnnotation<span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                    transactional <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aspectTransactional<span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token function">handleGlobalTransaction</span><span class="token punctuation">(</span>invocation<span class="token punctuation">,</span> transactional<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>globalLockAnnotation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token function">handleGlobalLock</span><span class="token punctuation">(</span>invocation<span class="token punctuation">,</span> globalLockAnnotation<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> invocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里边有两个分支，一个是如果<code>globalTransactionalAnnotation</code>或者<code>aspectTransactional</code>不是空的话，就进入<code>handleGlobalTransaction</code>，否则进入<code>handleGlobalLock</code></p><p>进入<code>org.apache.seata.integration.tx.api.interceptor.handler.GlobalTransactionalInterceptorHandler#handleGlobalTransaction</code>，其实只有一行<code>transactionalTemplate.execute</code>，但是这个方法的调用传了一个匿名内部类进来，看一下这个<code>execute</code>方法</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">TransactionalExecutor</span> business<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. Get transactionInfo</span></span>
<span class="line">    <span class="token class-name">TransactionInfo</span> txInfo <span class="token operator">=</span> business<span class="token punctuation">.</span><span class="token function">getTransactionInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>txInfo <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ShouldNeverHappenException</span><span class="token punctuation">(</span><span class="token string">&quot;transactionInfo does not exist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// 1.1 Get current transaction, if not null, the tx role is &#39;GlobalTransactionRole.Participant&#39;.</span></span>
<span class="line">    <span class="token class-name">GlobalTransaction</span> tx <span class="token operator">=</span> <span class="token class-name">GlobalTransactionContext</span><span class="token punctuation">.</span><span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 1.2 Handle the transaction propagation.</span></span>
<span class="line">    <span class="token class-name">Propagation</span> propagation <span class="token operator">=</span> txInfo<span class="token punctuation">.</span><span class="token function">getPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">SuspendedResourcesHolder</span> suspendedResourcesHolder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">switch</span> <span class="token punctuation">(</span>propagation<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token constant">NOT_SUPPORTED</span><span class="token operator">:</span></span>
<span class="line">                <span class="token comment">// If transaction is existing, suspend it.</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">existingTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    suspendedResourcesHolder <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">suspend</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// Execute without transaction and return.</span></span>
<span class="line">                <span class="token keyword">return</span> business<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token constant">REQUIRES_NEW</span><span class="token operator">:</span></span>
<span class="line">                <span class="token comment">// If transaction is existing, suspend it, and then begin new transaction.</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">existingTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    suspendedResourcesHolder <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">suspend</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                tx <span class="token operator">=</span> <span class="token class-name">GlobalTransactionContext</span><span class="token punctuation">.</span><span class="token function">createNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// Continue and execute with new transaction</span></span>
<span class="line">                <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token constant">SUPPORTS</span><span class="token operator">:</span></span>
<span class="line">                <span class="token comment">// If transaction is not existing, execute without transaction.</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">notExistingTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">return</span> business<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// Continue and execute with new transaction</span></span>
<span class="line">                <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token constant">REQUIRED</span><span class="token operator">:</span></span>
<span class="line">                <span class="token comment">// If current transaction is existing, execute with current transaction,else create</span></span>
<span class="line">                tx <span class="token operator">=</span> <span class="token class-name">GlobalTransactionContext</span><span class="token punctuation">.</span><span class="token function">getCurrentOrCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token constant">NEVER</span><span class="token operator">:</span></span>
<span class="line">                <span class="token comment">// If transaction is existing, throw exception.</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">existingTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TransactionException</span><span class="token punctuation">(</span></span>
<span class="line">                        <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Existing transaction found for transaction marked with propagation &#39;never&#39;, xid = %s&quot;</span></span>
<span class="line">                                      <span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">getXid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">// Execute without transaction and return.</span></span>
<span class="line">                    <span class="token keyword">return</span> business<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token constant">MANDATORY</span><span class="token operator">:</span></span>
<span class="line">                <span class="token comment">// If transaction is not existing, throw exception.</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">notExistingTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TransactionException</span><span class="token punctuation">(</span><span class="token string">&quot;No existing transaction found for transaction marked with propagation &#39;mandatory&#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// Continue and execute with current transaction.</span></span>
<span class="line">                <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TransactionException</span><span class="token punctuation">(</span><span class="token string">&quot;Not Supported Propagation:&quot;</span> <span class="token operator">+</span> propagation<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// set current tx config to holder</span></span>
<span class="line">        <span class="token class-name">GlobalLockConfig</span> previousConfig <span class="token operator">=</span> <span class="token function">replaceGlobalLockConfig</span><span class="token punctuation">(</span>txInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>tx<span class="token punctuation">.</span><span class="token function">getGlobalTransactionRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">GlobalTransactionRole<span class="token punctuation">.</span>Participant</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;join into a existing global transaction,xid={}&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">getXid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 2. If the tx role is &#39;GlobalTransactionRole.Launcher&#39;, send the request of beginTransaction to TC,</span></span>
<span class="line">            <span class="token comment">//    else do nothing. Of course, the hooks will still be triggered.</span></span>
<span class="line">            <span class="token function">beginTransaction</span><span class="token punctuation">(</span>txInfo<span class="token punctuation">,</span> tx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name">Object</span> rs<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// Do Your Business</span></span>
<span class="line">                rs <span class="token operator">=</span> business<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 3. The needed business exception to rollback.</span></span>
<span class="line">                <span class="token function">completeTransactionAfterThrowing</span><span class="token punctuation">(</span>txInfo<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">throw</span> ex<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 4. everything is fine, commit.</span></span>
<span class="line">            <span class="token function">commitTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> txInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">return</span> rs<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//5. clear</span></span>
<span class="line">            <span class="token function">resumeGlobalLockConfig</span><span class="token punctuation">(</span>previousConfig<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token function">cleanUp</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// If the transaction is suspended, resume it.</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>suspendedResourcesHolder <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            tx<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>suspendedResourcesHolder<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里看到两个重点内容：</p><ul><li>事务隔离级别</li></ul><p>seata自己定义了几种事务隔离级别，但基本上保持和spring的事务隔离级别一致，比如<code>NOT_SUPPORTED</code>级别的时候，将当前事务挂起，以非事务的方式执行并返回；再比如<code>REQUIRES_NEW</code>的时候，将当前事务挂起，然后创建一个新的事务并继续执行后续的事务和业务逻辑。</p><blockquote><p>这里一共定义了6种，相比较spring少了一种<code>NESTED</code>：</p><ul><li>NOT_SUPPORTED：不支持事务，如果有事务，则挂起，以非事务的方式运行</li><li>REQUIRES_NEW：如果当前有事务，则将当前事务挂起，然后新起一个事务执行</li><li>SUPPORTS：如果当前没有事务，则以非事务的方式执行，否则就以当前事务执行</li><li>REQUIRED：如果当前没有事务，则创建一个事务执行，否则就用当前事务执行</li><li>NEVER：如果当前存在事务，则报错，如果不存在事务，就正常按照非事务的方式执行</li><li>MANDATORY：如果当前事务不存在，则报错，如果存在，就以当前事务执行</li></ul></blockquote><ul><li>事务的处理</li></ul><p>上面的代码可以明显看到<code>beginTransaction</code>、<code>c</code>、<code>commitTransaction</code>、以及最里边的catch里边的<code>completeTransactionAfterThrowing</code></p><blockquote><p>1、beginTransaction方法</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token class-name">TransactionInfo</span> txInfo<span class="token punctuation">,</span> <span class="token class-name">GlobalTransaction</span> tx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>ExecutionException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>tx<span class="token punctuation">.</span><span class="token function">getGlobalTransactionRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">GlobalTransactionRole<span class="token punctuation">.</span>Launcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Ignore begin: just involved in global transaction [{}]&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">getXid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">triggerBeforeBegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        tx<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>txInfo<span class="token punctuation">.</span><span class="token function">getTimeOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> txInfo<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">triggerAfterBegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TransactionException</span> txe<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>ExecutionException</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> txe<span class="token punctuation">,</span></span>
<span class="line">                                                           <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>Code<span class="token punctuation">.</span>BeginFailure</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个方法里边就是触发事务开启之前、事务开启、以及触发开启事务之后三个方法，主要看下tx.begin</p><p><code>org.apache.seata.tm.api.DefaultGlobalTransaction#begin(int, java.lang.String)</code></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token keyword">int</span> timeout<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>createTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>role <span class="token operator">!=</span> <span class="token class-name">GlobalTransactionRole<span class="token punctuation">.</span>Launcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">assertXIDNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Ignore Begin(): just involved in global transaction [{}]&quot;</span><span class="token punctuation">,</span> xid<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">assertXIDNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> currentXid <span class="token operator">=</span> <span class="token class-name">RootContext</span><span class="token punctuation">.</span><span class="token function">getXID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentXid <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Global transaction already exists,&quot;</span> <span class="token operator">+</span></span>
<span class="line">                                        <span class="token string">&quot; can&#39;t begin a new global transaction, currentXid = &quot;</span> <span class="token operator">+</span> currentXid<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    xid <span class="token operator">=</span> transactionManager<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    status <span class="token operator">=</span> <span class="token class-name">GlobalStatus<span class="token punctuation">.</span>Begin</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">RootContext</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>xid<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Begin new global transaction [{}]&quot;</span><span class="token punctuation">,</span> xid<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个方法开启了一个事务，并且得到一个xid，然后将这个xid绑定到上下文中，具体怎么开启的事务呢？其实就是执行一个远程调用<code>org.apache.seata.tm.DefaultTransactionManager#begin</code></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token class-name">String</span> applicationId<span class="token punctuation">,</span> <span class="token class-name">String</span> transactionServiceGroup<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">GlobalBeginRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobalBeginRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    request<span class="token punctuation">.</span><span class="token function">setTransactionName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    request<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">GlobalBeginResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">GlobalBeginResponse</span><span class="token punctuation">)</span> <span class="token function">syncCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ResultCode<span class="token punctuation">.</span>Failed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TmTransactionException</span><span class="token punctuation">(</span><span class="token class-name">TransactionExceptionCode<span class="token punctuation">.</span>BeginFailed</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">getXid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也就是这里的<code>syncCall</code>，会得到一个响应</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalBeginResponse</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractTransactionResponse</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> xid<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> extraData<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2、commitTransaction</p><p>这个方法是提交事务的方法，方法里边如果超时，会回滚；如果正常提交，会在提交之前触发提交前的hook，在提交之后触发提交后的hook</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">commitTransaction</span><span class="token punctuation">(</span><span class="token class-name">GlobalTransaction</span> tx<span class="token punctuation">,</span> <span class="token class-name">TransactionInfo</span> txInfo<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">throws</span> <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">TransactionException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>tx<span class="token punctuation">.</span><span class="token function">getGlobalTransactionRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">GlobalTransactionRole<span class="token punctuation">.</span>Launcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Ignore commit: just involved in global transaction [{}]&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">getXid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTimeout</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> txInfo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// business execution timeout</span></span>
<span class="line">        <span class="token class-name">Exception</span> exx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TmTransactionException</span><span class="token punctuation">(</span><span class="token class-name">TransactionExceptionCode<span class="token punctuation">.</span>TransactionTimeout</span><span class="token punctuation">,</span></span>
<span class="line">                                                   <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;client detected transaction timeout before commit, so change to rollback, xid = %s&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">getXid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">rollbackTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> exx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">triggerBeforeCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        tx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">GlobalStatus</span> afterCommitStatus <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">getLocalStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>Code</span> code <span class="token operator">=</span> <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>Code<span class="token punctuation">.</span>Unknown</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">switch</span> <span class="token punctuation">(</span>afterCommitStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token class-name">TimeoutRollbacking</span><span class="token operator">:</span></span>
<span class="line">                code <span class="token operator">=</span> <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>Code<span class="token punctuation">.</span>Rollbacking</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token class-name">TimeoutRollbacked</span><span class="token operator">:</span></span>
<span class="line">                code <span class="token operator">=</span> <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>Code<span class="token punctuation">.</span>RollbackDone</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">case</span> <span class="token class-name">Finished</span><span class="token operator">:</span></span>
<span class="line">                code <span class="token operator">=</span> <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>Code<span class="token punctuation">.</span>CommitFailure</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token class-name">Exception</span> statusException <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">GlobalStatus</span><span class="token punctuation">.</span><span class="token function">isTwoPhaseHeuristic</span><span class="token punctuation">(</span>afterCommitStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            statusException <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TmTransactionException</span><span class="token punctuation">(</span><span class="token class-name">TransactionExceptionCode<span class="token punctuation">.</span>CommitHeuristic</span><span class="token punctuation">,</span></span>
<span class="line">                                                         <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Global transaction[%s] not found, may be rollbacked.&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">getXid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">GlobalStatus</span><span class="token punctuation">.</span><span class="token function">isOnePhaseTimeout</span><span class="token punctuation">(</span>afterCommitStatus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            statusException <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TmTransactionException</span><span class="token punctuation">(</span><span class="token class-name">TransactionExceptionCode<span class="token punctuation">.</span>TransactionTimeout</span><span class="token punctuation">,</span></span>
<span class="line">                                                         <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Global transaction[%s] is timeout and will be rollback[TC].&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">getXid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> statusException<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>ExecutionException</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> statusException<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token function">triggerAfterCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TransactionException</span> txe<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 4.1 Failed to commit</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>ExecutionException</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> txe<span class="token punctuation">,</span></span>
<span class="line">                                                           <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>Code<span class="token punctuation">.</span>CommitFailure</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3、completeTransactionAfterThrowing</p><p>这个方法在catch里边，也就是说当程序执行异常的时候会执行。点进去看到里边会进行事务的回滚（事务信息不为空 且 抛出的异常是指定的事务回滚异常）</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">completeTransactionAfterThrowing</span><span class="token punctuation">(</span><span class="token class-name">TransactionInfo</span> txInfo<span class="token punctuation">,</span> <span class="token class-name">GlobalTransaction</span> tx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> originalException<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">throws</span> <span class="token class-name">TransactionalExecutor<span class="token punctuation">.</span>ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">TransactionException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//roll back</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>txInfo <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> txInfo<span class="token punctuation">.</span><span class="token function">rollbackOn</span><span class="token punctuation">(</span>originalException<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">rollbackTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> originalException<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// not roll back on this exception, so commit</span></span>
<span class="line">        <span class="token function">commitTransaction</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> txInfo<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4、business.execute</p><p>执行的业务方法</p></blockquote><h3 id="_2-3、各事务角色的请求交互" tabindex="-1"><a class="header-anchor" href="#_2-3、各事务角色的请求交互"><span>2.3、各事务角色的请求交互</span></a></h3><p>前面看到事务的”拆解“执行过程，那么RM/TM与RC之间是如何交互的呢？总的来说有异步和同步的方式。下面以开启事务方法<code>org.apache.seata.tm.DefaultTransactionManager#begin</code>为例</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token class-name">String</span> applicationId<span class="token punctuation">,</span> <span class="token class-name">String</span> transactionServiceGroup<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">GlobalBeginRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlobalBeginRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    request<span class="token punctuation">.</span><span class="token function">setTransactionName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    request<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">GlobalBeginResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">GlobalBeginResponse</span><span class="token punctuation">)</span> <span class="token function">syncCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ResultCode<span class="token punctuation">.</span>Failed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TmTransactionException</span><span class="token punctuation">(</span><span class="token class-name">TransactionExceptionCode<span class="token punctuation">.</span>BeginFailed</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">getXid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>继续看<code>syncCall</code>方法</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token class-name">AbstractTransactionResponse</span> <span class="token function">syncCall</span><span class="token punctuation">(</span><span class="token class-name">AbstractTransactionRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransactionException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">AbstractTransactionResponse</span><span class="token punctuation">)</span> <span class="token class-name">TmNettyRemotingClient</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendSyncRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TimeoutException</span> toe<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TmTransactionException</span><span class="token punctuation">(</span><span class="token class-name">TransactionExceptionCode</span><span class="token punctuation">.</span><span class="token constant">IO</span><span class="token punctuation">,</span> <span class="token string">&quot;RPC timeout&quot;</span><span class="token punctuation">,</span> toe<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>继续<code>org.apache.seata.core.rpc.netty.AbstractNettyRemotingClient#sendSyncRequest(java.lang.Object)</code>方法</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">sendSyncRequest</span><span class="token punctuation">(</span><span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span> serverAddress <span class="token operator">=</span> <span class="token function">loadBalance</span><span class="token punctuation">(</span><span class="token function">getTransactionServiceGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">long</span> timeoutMillis <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRpcRequestTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">RpcMessage</span> rpcMessage <span class="token operator">=</span> <span class="token function">buildRequestMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token class-name">ProtocolConstants</span><span class="token punctuation">.</span><span class="token constant">MSGTYPE_RESQUEST_SYNC</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// send batch message</span></span>
<span class="line">    <span class="token comment">// put message into basketMap, @see MergedSendRunnable</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isEnableClientBatchSendRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// send batch message is sync request, needs to create messageFuture and put it in futures.</span></span>
<span class="line">        <span class="token class-name">MessageFuture</span> messageFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        messageFuture<span class="token punctuation">.</span><span class="token function">setRequestMessage</span><span class="token punctuation">(</span>rpcMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        messageFuture<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>timeoutMillis<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        futures<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>rpcMessage<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> messageFuture<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// put message into basketMap</span></span>
<span class="line">        <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RpcMessage</span><span class="token punctuation">&gt;</span></span> basket <span class="token operator">=</span> <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span>basketMap<span class="token punctuation">,</span> serverAddress<span class="token punctuation">,</span></span>
<span class="line">                                                                           key <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>basket<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>rpcMessage<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;put message into basketMap offer failed, serverAddress:{},rpcMessage:{}&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                         serverAddress<span class="token punctuation">,</span> rpcMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;offer message: {}&quot;</span><span class="token punctuation">,</span> rpcMessage<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isSending<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mergeLock<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                mergeLock<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Object</span> response <span class="token operator">=</span> messageFuture<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>timeoutMillis<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span> response<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> exx<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;wait response error:{},ip:{},request:{}&quot;</span><span class="token punctuation">,</span> exx<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> serverAddress<span class="token punctuation">,</span> rpcMessage<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>exx <span class="token keyword">instanceof</span> <span class="token class-name">TimeoutException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token class-name">TimeoutException</span><span class="token punctuation">)</span>exx<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>exx<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> clientChannelManager<span class="token punctuation">.</span><span class="token function">acquireChannel</span><span class="token punctuation">(</span>serverAddress<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sendSync</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> rpcMessage<span class="token punctuation">,</span> timeoutMillis<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个方法里边，外边的if分支逻辑为如果开启了批量提交请求，则走if，否则，就同步调用else里边的逻辑。而在if这个逻辑里边seata的方案是将请求封装成一个<code>org.apache.seata.core.protocol.RpcMessage</code>对象，然后将其丢到一个阻塞队列里边，交由定时异步任务去消费处理。这个阻塞队列又以<code>serverAddress</code>作为key放到了一个map里边。异步任务真正获取数据是从这个map里边获取的。</p><p>这个<code>basketMap</code>在哪儿消费处理呢？</p><p>前面我们在看RM、TM建立与TC连接的代码的时候就看到了<code>org.apache.seata.core.rpc.netty.AbstractNettyRemotingClient#init</code></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    timerExecutor<span class="token punctuation">.</span><span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            clientChannelManager<span class="token punctuation">.</span><span class="token function">reconnect</span><span class="token punctuation">(</span><span class="token function">getTransactionServiceGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;reconnect server failed. {}&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">SCHEDULE_DELAY_MILLS</span><span class="token punctuation">,</span> <span class="token constant">SCHEDULE_INTERVAL_MILLS</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isEnableClientBatchSendRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        mergeSendExecutorService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token constant">MAX_MERGE_SEND_THREAD</span><span class="token punctuation">,</span></span>
<span class="line">                                                          <span class="token constant">MAX_MERGE_SEND_THREAD</span><span class="token punctuation">,</span></span>
<span class="line">                                                          <span class="token constant">KEEP_ALIVE_TIME</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">,</span></span>
<span class="line">                                                          <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                                                          <span class="token keyword">new</span> <span class="token class-name">NamedThreadFactory</span><span class="token punctuation">(</span><span class="token function">getThreadPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">MAX_MERGE_SEND_THREAD</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        mergeSendExecutorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MergedSendRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    clientBootstrap<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里一个将一个<code>MergedSendRunnable</code>的任务丢到了线程池中去交由线程池调度执行。这个类的run方法如下：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mergeLock<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                mergeLock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token constant">MAX_MERGE_SEND_MILLS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        isSending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">        basketMap<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> basket<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>basket<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token class-name">MergedWarpMessage</span> mergeMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MergedWarpMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>basket<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">RpcMessage</span> msg <span class="token operator">=</span> basket<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                mergeMessage<span class="token punctuation">.</span>msgs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AbstractMessage</span><span class="token punctuation">)</span> msg<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                mergeMessage<span class="token punctuation">.</span>msgIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>mergeMessage<span class="token punctuation">.</span>msgIds<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">printMergeMessageLog</span><span class="token punctuation">(</span>mergeMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token class-name">Channel</span> sendChannel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// send batch message is sync request, but there is no need to get the return value.</span></span>
<span class="line">                <span class="token comment">// Since the messageFuture has been created before the message is placed in basketMap,</span></span>
<span class="line">                <span class="token comment">// the return value will be obtained in ClientOnResponseProcessor.</span></span>
<span class="line">                sendChannel <span class="token operator">=</span> clientChannelManager<span class="token punctuation">.</span><span class="token function">acquireChannel</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">AbstractNettyRemotingClient</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendAsyncRequest</span><span class="token punctuation">(</span>sendChannel<span class="token punctuation">,</span> mergeMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FrameworkException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getErrcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">FrameworkErrorCode<span class="token punctuation">.</span>ChannelIsNotWritable</span> <span class="token operator">&amp;&amp;</span> sendChannel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">destroyChannel</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> sendChannel<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// fast fail</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> msgId <span class="token operator">:</span> mergeMessage<span class="token punctuation">.</span>msgIds<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">MessageFuture</span> messageFuture <span class="token operator">=</span> futures<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>msgId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token class-name">Integer</span> parentId <span class="token operator">=</span> childToParentMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>msgId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>parentId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        mergeMsgMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>parentId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>messageFuture <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        messageFuture<span class="token punctuation">.</span><span class="token function">setResultMessage</span><span class="token punctuation">(</span></span>
<span class="line">                            <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s is unreachable&quot;</span><span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;client merge call failed: {}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        isSending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个任务类的run方法的try里边就是真正发送请求的方法<code>AbstractNettyRemotingClient.this.sendAsyncRequest(sendChannel, mergeMessage);</code></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendAsyncRequest</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> channel<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>channel <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;sendAsyncRequest nothing, caused by null channel.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token class-name">RpcMessage</span> rpcMessage <span class="token operator">=</span> <span class="token function">buildRequestMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> msg <span class="token keyword">instanceof</span> <span class="token class-name">HeartbeatMessage</span></span>
<span class="line">                                                <span class="token operator">?</span> <span class="token class-name">ProtocolConstants</span><span class="token punctuation">.</span><span class="token constant">MSGTYPE_HEARTBEAT_REQUEST</span></span>
<span class="line">                                                <span class="token operator">:</span> <span class="token class-name">ProtocolConstants</span><span class="token punctuation">.</span><span class="token constant">MSGTYPE_RESQUEST_ONEWAY</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Object</span> body <span class="token operator">=</span> rpcMessage<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token keyword">instanceof</span> <span class="token class-name">MergeMessage</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Integer</span> parentId <span class="token operator">=</span> rpcMessage<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        mergeMsgMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>parentId<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">MergeMessage</span><span class="token punctuation">)</span>rpcMessage<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token keyword">instanceof</span> <span class="token class-name">MergedWarpMessage</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> msgId <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MergedWarpMessage</span><span class="token punctuation">)</span>rpcMessage<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>msgIds<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                childToParentMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>msgId<span class="token punctuation">,</span> parentId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sendAsync</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> rpcMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><img src="http://blog.shengxiao.tech/images/subscribe1.png" alt="扫码关注"></p></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->编辑当前页面<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->最后更新时间： 2026/1/9 12:01:27<!--]--></span></span></div></footer><nav class="page-nav"><p class="hasPrev inner"><span class="page-nav-item prev"> ← 4、分布式事务Seata的高级应用详解</span><!----></p></nav><div class="reco-valine-wrapper"><div id="valine"></div></div></div><div class="page-catalog-container"><h5 class="tip">页面导航</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/series/distribution/fenbushishiwu/05fenbushishiwuSeatayuanmaxuexi.html#_1、seata的at模型回顾" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1、Seata的AT模型回顾"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1、Seata的AT模型回顾<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/series/distribution/fenbushishiwu/05fenbushishiwuSeatayuanmaxuexi.html#_1-1、seata的at模型" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.1、Seata的AT模型"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.1、Seata的AT模型<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/series/distribution/fenbushishiwu/05fenbushishiwuSeatayuanmaxuexi.html#_1-2、seata的at模型在实际开发中的应用" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.2、Seata的AT模型在实际开发中的应用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.2、Seata的AT模型在实际开发中的应用<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/series/distribution/fenbushishiwu/05fenbushishiwuSeatayuanmaxuexi.html#_2、核心步骤源码分析-at" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2、核心步骤源码分析（AT）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2、核心步骤源码分析（AT）<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/series/distribution/fenbushishiwu/05fenbushishiwuSeatayuanmaxuexi.html#_2-1、rm、tm建立与tc的连接" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.1、RM、TM建立与TC的连接"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.1、RM、TM建立与TC的连接<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/series/distribution/fenbushishiwu/05fenbushishiwuSeatayuanmaxuexi.html#_2-2、事务处理" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.2、事务处理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.2、事务处理<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/series/distribution/fenbushishiwu/05fenbushishiwuSeatayuanmaxuexi.html#_2-3、各事务角色的请求交互" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.3、各事务角色的请求交互"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.3、各事务角色的请求交互<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CUmx0lpF.js" defer></script>
  </body>
</html>
